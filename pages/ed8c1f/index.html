<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/pages/ed8c1f/"><meta property="og:site_name" content="å­¦ä¹ ç¬”è®°"><meta property="og:title" content="å¹¶å‘é”æœºåˆ¶ä¹‹synchronized"><meta property="og:description" content="synchronizedåŸºç¡€ç¯‡ Javaå…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ æ€è€ƒï¼š ä¸¤ä¸ªçº¿ç¨‹å¯¹åˆå§‹å€¼ä¸º 0 çš„é™æ€å˜é‡ä¸€ä¸ªåšè‡ªå¢ï¼Œä¸€ä¸ªåšè‡ªå‡ï¼Œå„åš 5000 æ¬¡ï¼Œç»“æœæ˜¯ 0 å—ï¼Ÿ public class SyncDemo { private static int counter = 0; public static void increment() { counter++; } public static void decrement() { counter--; } public static void main(String[] args) throws InterruptedException { Thread t1 = new Thread(() -&gt; { for (int i = 0; i &lt; 5000; i++) { increment(); } }, "t1"); Thread t2 = new Thread(() -&gt; { for (int i = 0; i &lt; 5000; i++) { decrement(); } }, "t2"); t1.start(); t2.start(); t1.join(); t2.join(); //æ€è€ƒï¼š counter=ï¼Ÿ log.info("{}", counter); } }"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-08-01T18:24:48.000Z"><meta property="article:author" content="æ±Ÿ"><meta property="article:published_time" content="2022-11-22T00:12:52.000Z"><meta property="article:modified_time" content="2023-08-01T18:24:48.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"å¹¶å‘é”æœºåˆ¶ä¹‹synchronized","image":[""],"datePublished":"2022-11-22T00:12:52.000Z","dateModified":"2023-08-01T18:24:48.000Z","author":[{"@type":"Person","name":"æ±Ÿ"}]}</script><title>å¹¶å‘é”æœºåˆ¶ä¹‹synchronized | å­¦ä¹ ç¬”è®°</title><meta name="description" content="synchronizedåŸºç¡€ç¯‡ Javaå…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ æ€è€ƒï¼š ä¸¤ä¸ªçº¿ç¨‹å¯¹åˆå§‹å€¼ä¸º 0 çš„é™æ€å˜é‡ä¸€ä¸ªåšè‡ªå¢ï¼Œä¸€ä¸ªåšè‡ªå‡ï¼Œå„åš 5000 æ¬¡ï¼Œç»“æœæ˜¯ 0 å—ï¼Ÿ public class SyncDemo { private static int counter = 0; public static void increment() { counter++; } public static void decrement() { counter--; } public static void main(String[] args) throws InterruptedException { Thread t1 = new Thread(() -&gt; { for (int i = 0; i &lt; 5000; i++) { increment(); } }, "t1"); Thread t2 = new Thread(() -&gt; { for (int i = 0; i &lt; 5000; i++) { decrement(); } }, "t2"); t1.start(); t2.start(); t1.join(); t2.join(); //æ€è€ƒï¼š counter=ï¼Ÿ log.info("{}", counter); } }">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-d225b157.css" as="style"><link rel="stylesheet" href="/assets/style-d225b157.css">
    <link rel="modulepreload" href="/assets/app-c8395efa.js"><link rel="modulepreload" href="/assets/index.html-b3f10bbb.js"><link rel="modulepreload" href="/assets/index.html-789c7f96.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/intro.html-d050d194.js" as="script"><link rel="prefetch" href="/assets/index.html-3841b971.js" as="script"><link rel="prefetch" href="/assets/slides.html-4bcf9c90.js" as="script"><link rel="prefetch" href="/assets/index.html-9da1f986.js" as="script"><link rel="prefetch" href="/assets/index.html-06aa5afc.js" as="script"><link rel="prefetch" href="/assets/index.html-3cde2e9d.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-e29efed5.js" as="script"><link rel="prefetch" href="/assets/index.html-056a7c7b.js" as="script"><link rel="prefetch" href="/assets/index.html-196aee9a.js" as="script"><link rel="prefetch" href="/assets/index.html-15356fd6.js" as="script"><link rel="prefetch" href="/assets/index.html-b2ea937f.js" as="script"><link rel="prefetch" href="/assets/index.html-fae2cce2.js" as="script"><link rel="prefetch" href="/assets/index.html-3de3ac13.js" as="script"><link rel="prefetch" href="/assets/index.html-4fc833f7.js" as="script"><link rel="prefetch" href="/assets/index.html-a9380d59.js" as="script"><link rel="prefetch" href="/assets/index.html-0c227f79.js" as="script"><link rel="prefetch" href="/assets/index.html-ca9e9edd.js" as="script"><link rel="prefetch" href="/assets/index.html-3d73ef7f.js" as="script"><link rel="prefetch" href="/assets/index.html-eff3b4ec.js" as="script"><link rel="prefetch" href="/assets/index.html-63004bbb.js" as="script"><link rel="prefetch" href="/assets/index.html-b443c91f.js" as="script"><link rel="prefetch" href="/assets/index.html-eb7dc294.js" as="script"><link rel="prefetch" href="/assets/index.html-6036577c.js" as="script"><link rel="prefetch" href="/assets/index.html-58352f8e.js" as="script"><link rel="prefetch" href="/assets/index.html-47cee948.js" as="script"><link rel="prefetch" href="/assets/index.html-1460385b.js" as="script"><link rel="prefetch" href="/assets/00.ç«™åœ¨å…¨å±€è§†è§’ç†è§£ç³»ç»Ÿé«˜å¹¶å‘.html-3a469a4c.js" as="script"><link rel="prefetch" href="/assets/index.html-1fffc64f.js" as="script"><link rel="prefetch" href="/assets/10.BIO NIOç¼–ç¨‹ä¸ç›´æ¥å†…å­˜é›¶æ‹·è´.html-0ab5e5cc.js" as="script"><link rel="prefetch" href="/assets/index.html-fbcf9615.js" as="script"><link rel="prefetch" href="/assets/index.html-a1cae865.js" as="script"><link rel="prefetch" href="/assets/index.html-e045b02c.js" as="script"><link rel="prefetch" href="/assets/index.html-ab40fe3b.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-58f47ed2.js" as="script"><link rel="prefetch" href="/assets/index.html-78dacd72.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-d6647704.js" as="script"><link rel="prefetch" href="/assets/index.html-59afda48.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-d969e8ed.js" as="script"><link rel="prefetch" href="/assets/index.html-edca6dc4.js" as="script"><link rel="prefetch" href="/assets/index.html-1ae26749.js" as="script"><link rel="prefetch" href="/assets/index.html-f93219f2.js" as="script"><link rel="prefetch" href="/assets/index.html-31118532.js" as="script"><link rel="prefetch" href="/assets/å·¥å‚æ¨¡å¼.html-ad9410a3.js" as="script"><link rel="prefetch" href="/assets/å»ºé€ æ¨¡å¼.html-a04d73b9.js" as="script"><link rel="prefetch" href="/assets/index.html-c071222c.js" as="script"><link rel="prefetch" href="/assets/index.html-a4f315bf.js" as="script"><link rel="prefetch" href="/assets/index.html-b0022173.js" as="script"><link rel="prefetch" href="/assets/index.html-38e14dc8.js" as="script"><link rel="prefetch" href="/assets/index.html-cc3cc56c.js" as="script"><link rel="prefetch" href="/assets/index.html-68bfa6a5.js" as="script"><link rel="prefetch" href="/assets/00.é«˜æ€§èƒ½MySQL-MySQLæ¶æ„.html-6d7f7e17.js" as="script"><link rel="prefetch" href="/assets/index.html-4cecd512.js" as="script"><link rel="prefetch" href="/assets/index.html-99ad6842.js" as="script"><link rel="prefetch" href="/assets/index.html-675c676e.js" as="script"><link rel="prefetch" href="/assets/index.html-2855e279.js" as="script"><link rel="prefetch" href="/assets/index.html-9c62895c.js" as="script"><link rel="prefetch" href="/assets/index.html-aa30bf04.js" as="script"><link rel="prefetch" href="/assets/index.html-18f91996.js" as="script"><link rel="prefetch" href="/assets/index.html-d4863e55.js" as="script"><link rel="prefetch" href="/assets/index.html-546eb3a2.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-0e42a487.js" as="script"><link rel="prefetch" href="/assets/index.html-53d3a5ee.js" as="script"><link rel="prefetch" href="/assets/index.html-2ee74260.js" as="script"><link rel="prefetch" href="/assets/index.html-1f029277.js" as="script"><link rel="prefetch" href="/assets/index.html-c20a9e23.js" as="script"><link rel="prefetch" href="/assets/index.html-af52d031.js" as="script"><link rel="prefetch" href="/assets/index.html-9308d7ca.js" as="script"><link rel="prefetch" href="/assets/20.å…³ç³»å‹æ•°æ®åº“å±‚é¢çš„é«˜å¹¶å‘ä¼˜åŒ–.html-610c7929.js" as="script"><link rel="prefetch" href="/assets/Sharding-JDBCåˆ†åº“åˆ†è¡¨åº”ç”¨å®æˆ˜.html-fe196458.js" as="script"><link rel="prefetch" href="/assets/index.html-d1e1f170.js" as="script"><link rel="prefetch" href="/assets/10.ShardingJDBCåˆ†åº“åˆ†è¡¨å®æˆ˜æŒ‡å—.html-fbff4896.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-1d5254a6.js" as="script"><link rel="prefetch" href="/assets/index.html-263f14aa.js" as="script"><link rel="prefetch" href="/assets/index.html-768ded15.js" as="script"><link rel="prefetch" href="/assets/index.html-25fcc8f6.js" as="script"><link rel="prefetch" href="/assets/index.html-8e0ddc23.js" as="script"><link rel="prefetch" href="/assets/index.html-ad1ece24.js" as="script"><link rel="prefetch" href="/assets/index.html-fb73493c.js" as="script"><link rel="prefetch" href="/assets/index.html-128d4b71.js" as="script"><link rel="prefetch" href="/assets/index.html-d9f15724.js" as="script"><link rel="prefetch" href="/assets/index.html-72ba2d35.js" as="script"><link rel="prefetch" href="/assets/index.html-951dfe3f.js" as="script"><link rel="prefetch" href="/assets/index.html-c6d45626.js" as="script"><link rel="prefetch" href="/assets/index.html-859c676b.js" as="script"><link rel="prefetch" href="/assets/index.html-fe205ef8.js" as="script"><link rel="prefetch" href="/assets/index.html-0cb20f1c.js" as="script"><link rel="prefetch" href="/assets/index.html-102cfae4.js" as="script"><link rel="prefetch" href="/assets/index.html-ae48c1df.js" as="script"><link rel="prefetch" href="/assets/index.html-814f7f1d.js" as="script"><link rel="prefetch" href="/assets/index.html-19779ea0.js" as="script"><link rel="prefetch" href="/assets/index.html-09cc3a43.js" as="script"><link rel="prefetch" href="/assets/index.html-cccbb13c.js" as="script"><link rel="prefetch" href="/assets/index.html-b8130103.js" as="script"><link rel="prefetch" href="/assets/index.html-1b4e8107.js" as="script"><link rel="prefetch" href="/assets/index.html-7045cf91.js" as="script"><link rel="prefetch" href="/assets/index.html-82e85232.js" as="script"><link rel="prefetch" href="/assets/index.html-46b70d01.js" as="script"><link rel="prefetch" href="/assets/index.html-a6c441fe.js" as="script"><link rel="prefetch" href="/assets/index.html-38736ecd.js" as="script"><link rel="prefetch" href="/assets/index.html-3d160279.js" as="script"><link rel="prefetch" href="/assets/index.html-70184545.js" as="script"><link rel="prefetch" href="/assets/index.html-0d7f9c84.js" as="script"><link rel="prefetch" href="/assets/index.html-50ec0628.js" as="script"><link rel="prefetch" href="/assets/index.html-6647c88b.js" as="script"><link rel="prefetch" href="/assets/index.html-e5fca210.js" as="script"><link rel="prefetch" href="/assets/index.html-4622c4d0.js" as="script"><link rel="prefetch" href="/assets/index.html-0aa16773.js" as="script"><link rel="prefetch" href="/assets/index.html-bcad5cb1.js" as="script"><link rel="prefetch" href="/assets/index.html-63434f2e.js" as="script"><link rel="prefetch" href="/assets/index.html-645f2ddf.js" as="script"><link rel="prefetch" href="/assets/index.html-254985ce.js" as="script"><link rel="prefetch" href="/assets/index.html-a8a57423.js" as="script"><link rel="prefetch" href="/assets/index.html-60388c3a.js" as="script"><link rel="prefetch" href="/assets/index.html-159ca966.js" as="script"><link rel="prefetch" href="/assets/index.html-f0d68cb4.js" as="script"><link rel="prefetch" href="/assets/index.html-fbc23d80.js" as="script"><link rel="prefetch" href="/assets/index.html-d478e84e.js" as="script"><link rel="prefetch" href="/assets/index.html-2c89d1e5.js" as="script"><link rel="prefetch" href="/assets/index.html-22f6ba4c.js" as="script"><link rel="prefetch" href="/assets/index.html-8d73c7f5.js" as="script"><link rel="prefetch" href="/assets/index.html-1534c5b2.js" as="script"><link rel="prefetch" href="/assets/index.html-7c9f70b1.js" as="script"><link rel="prefetch" href="/assets/index.html-e60f4990.js" as="script"><link rel="prefetch" href="/assets/index.html-775dacd4.js" as="script"><link rel="prefetch" href="/assets/index.html-cd6512b5.js" as="script"><link rel="prefetch" href="/assets/index.html-0df55126.js" as="script"><link rel="prefetch" href="/assets/index.html-ee2ee741.js" as="script"><link rel="prefetch" href="/assets/index.html-0cefaac0.js" as="script"><link rel="prefetch" href="/assets/Seataäº‹åŠ¡æ¨¡å¼.html-c1a2d7b8.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-1dd75d49.js" as="script"><link rel="prefetch" href="/assets/index.html-8129550b.js" as="script"><link rel="prefetch" href="/assets/index.html-e6f50774.js" as="script"><link rel="prefetch" href="/assets/index.html-881fba3f.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-eb0655fe.js" as="script"><link rel="prefetch" href="/assets/404.html-f4f9fdbe.js" as="script"><link rel="prefetch" href="/assets/index.html-ccedd87a.js" as="script"><link rel="prefetch" href="/assets/index.html-6b635626.js" as="script"><link rel="prefetch" href="/assets/index.html-0d639806.js" as="script"><link rel="prefetch" href="/assets/index.html-19b5aac4.js" as="script"><link rel="prefetch" href="/assets/index.html-f3c1ea90.js" as="script"><link rel="prefetch" href="/assets/index.html-e4505c26.js" as="script"><link rel="prefetch" href="/assets/index.html-c67c6358.js" as="script"><link rel="prefetch" href="/assets/index.html-08bdbe35.js" as="script"><link rel="prefetch" href="/assets/index.html-39a19522.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6ecfce.js" as="script"><link rel="prefetch" href="/assets/index.html-c37db087.js" as="script"><link rel="prefetch" href="/assets/index.html-7f2f880b.js" as="script"><link rel="prefetch" href="/assets/index.html-f8546af5.js" as="script"><link rel="prefetch" href="/assets/index.html-36e6cb8c.js" as="script"><link rel="prefetch" href="/assets/index.html-27371869.js" as="script"><link rel="prefetch" href="/assets/index.html-4c15c6fc.js" as="script"><link rel="prefetch" href="/assets/index.html-116aca17.js" as="script"><link rel="prefetch" href="/assets/index.html-2a643c60.js" as="script"><link rel="prefetch" href="/assets/index.html-21236a9b.js" as="script"><link rel="prefetch" href="/assets/index.html-b238d9f4.js" as="script"><link rel="prefetch" href="/assets/index.html-46e55ee3.js" as="script"><link rel="prefetch" href="/assets/index.html-6d53c5d1.js" as="script"><link rel="prefetch" href="/assets/index.html-778d883e.js" as="script"><link rel="prefetch" href="/assets/index.html-d798a209.js" as="script"><link rel="prefetch" href="/assets/index.html-9fa57983.js" as="script"><link rel="prefetch" href="/assets/index.html-ab8b6fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-200c9b62.js" as="script"><link rel="prefetch" href="/assets/index.html-d67216d5.js" as="script"><link rel="prefetch" href="/assets/index.html-30ef2e2b.js" as="script"><link rel="prefetch" href="/assets/index.html-2a6dfb95.js" as="script"><link rel="prefetch" href="/assets/index.html-3fd779a7.js" as="script"><link rel="prefetch" href="/assets/index.html-0118c6d9.js" as="script"><link rel="prefetch" href="/assets/index.html-41b511cf.js" as="script"><link rel="prefetch" href="/assets/index.html-942ff972.js" as="script"><link rel="prefetch" href="/assets/index.html-2be3f4a2.js" as="script"><link rel="prefetch" href="/assets/index.html-4b04c8af.js" as="script"><link rel="prefetch" href="/assets/index.html-f3f33451.js" as="script"><link rel="prefetch" href="/assets/index.html-940c35a3.js" as="script"><link rel="prefetch" href="/assets/index.html-1a8f23e9.js" as="script"><link rel="prefetch" href="/assets/index.html-c93e5cd2.js" as="script"><link rel="prefetch" href="/assets/index.html-6508b456.js" as="script"><link rel="prefetch" href="/assets/index.html-d92890df.js" as="script"><link rel="prefetch" href="/assets/index.html-b2b41008.js" as="script"><link rel="prefetch" href="/assets/index.html-ed0506a1.js" as="script"><link rel="prefetch" href="/assets/index.html-ac4c44c1.js" as="script"><link rel="prefetch" href="/assets/index.html-0ef231d8.js" as="script"><link rel="prefetch" href="/assets/intro.html-1534cff9.js" as="script"><link rel="prefetch" href="/assets/index.html-b9ef54d3.js" as="script"><link rel="prefetch" href="/assets/slides.html-c1f13126.js" as="script"><link rel="prefetch" href="/assets/index.html-c41c17ee.js" as="script"><link rel="prefetch" href="/assets/index.html-33a28639.js" as="script"><link rel="prefetch" href="/assets/index.html-99549339.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-ef0edff8.js" as="script"><link rel="prefetch" href="/assets/index.html-9bb02a02.js" as="script"><link rel="prefetch" href="/assets/index.html-593591fd.js" as="script"><link rel="prefetch" href="/assets/index.html-bc476d77.js" as="script"><link rel="prefetch" href="/assets/index.html-0411d0ed.js" as="script"><link rel="prefetch" href="/assets/index.html-5c950c27.js" as="script"><link rel="prefetch" href="/assets/index.html-fd5fb029.js" as="script"><link rel="prefetch" href="/assets/index.html-19bcbe86.js" as="script"><link rel="prefetch" href="/assets/index.html-11858a28.js" as="script"><link rel="prefetch" href="/assets/index.html-123e5ffb.js" as="script"><link rel="prefetch" href="/assets/index.html-c04a70de.js" as="script"><link rel="prefetch" href="/assets/index.html-3cb86069.js" as="script"><link rel="prefetch" href="/assets/index.html-7cead407.js" as="script"><link rel="prefetch" href="/assets/index.html-f35dbb09.js" as="script"><link rel="prefetch" href="/assets/index.html-b2e85ea0.js" as="script"><link rel="prefetch" href="/assets/index.html-f849173e.js" as="script"><link rel="prefetch" href="/assets/index.html-4fffbeeb.js" as="script"><link rel="prefetch" href="/assets/index.html-859e3097.js" as="script"><link rel="prefetch" href="/assets/index.html-4d3422c7.js" as="script"><link rel="prefetch" href="/assets/index.html-0292b67e.js" as="script"><link rel="prefetch" href="/assets/00.ç«™åœ¨å…¨å±€è§†è§’ç†è§£ç³»ç»Ÿé«˜å¹¶å‘.html-518d6a0e.js" as="script"><link rel="prefetch" href="/assets/index.html-97a62811.js" as="script"><link rel="prefetch" href="/assets/10.BIO NIOç¼–ç¨‹ä¸ç›´æ¥å†…å­˜é›¶æ‹·è´.html-df29a1a2.js" as="script"><link rel="prefetch" href="/assets/index.html-8c267f92.js" as="script"><link rel="prefetch" href="/assets/index.html-6c51f37f.js" as="script"><link rel="prefetch" href="/assets/index.html-1b69acc6.js" as="script"><link rel="prefetch" href="/assets/index.html-b5ab3d0a.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-04480c7b.js" as="script"><link rel="prefetch" href="/assets/index.html-5f798258.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-ff8d33ef.js" as="script"><link rel="prefetch" href="/assets/index.html-5f36b633.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-4cbc5e0a.js" as="script"><link rel="prefetch" href="/assets/index.html-79a9dcad.js" as="script"><link rel="prefetch" href="/assets/index.html-888d5791.js" as="script"><link rel="prefetch" href="/assets/index.html-45485371.js" as="script"><link rel="prefetch" href="/assets/index.html-fe8b12e5.js" as="script"><link rel="prefetch" href="/assets/å·¥å‚æ¨¡å¼.html-5d00ddae.js" as="script"><link rel="prefetch" href="/assets/å»ºé€ æ¨¡å¼.html-2f896000.js" as="script"><link rel="prefetch" href="/assets/index.html-f4cf0d43.js" as="script"><link rel="prefetch" href="/assets/index.html-bdcaed66.js" as="script"><link rel="prefetch" href="/assets/index.html-5e8162db.js" as="script"><link rel="prefetch" href="/assets/index.html-1053a2cd.js" as="script"><link rel="prefetch" href="/assets/index.html-b5c55f02.js" as="script"><link rel="prefetch" href="/assets/index.html-43dca84a.js" as="script"><link rel="prefetch" href="/assets/00.é«˜æ€§èƒ½MySQL-MySQLæ¶æ„.html-29da47a5.js" as="script"><link rel="prefetch" href="/assets/index.html-85748a34.js" as="script"><link rel="prefetch" href="/assets/index.html-82f9645c.js" as="script"><link rel="prefetch" href="/assets/index.html-5d93c981.js" as="script"><link rel="prefetch" href="/assets/index.html-b0527e36.js" as="script"><link rel="prefetch" href="/assets/index.html-f2247e3b.js" as="script"><link rel="prefetch" href="/assets/index.html-248a2ffe.js" as="script"><link rel="prefetch" href="/assets/index.html-b2b987f8.js" as="script"><link rel="prefetch" href="/assets/index.html-83d8990c.js" as="script"><link rel="prefetch" href="/assets/index.html-241661b4.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-4175bb43.js" as="script"><link rel="prefetch" href="/assets/index.html-807bf4b3.js" as="script"><link rel="prefetch" href="/assets/index.html-dd33c233.js" as="script"><link rel="prefetch" href="/assets/index.html-4232d92b.js" as="script"><link rel="prefetch" href="/assets/index.html-3967073d.js" as="script"><link rel="prefetch" href="/assets/index.html-92dd5d75.js" as="script"><link rel="prefetch" href="/assets/index.html-0f01692d.js" as="script"><link rel="prefetch" href="/assets/20.å…³ç³»å‹æ•°æ®åº“å±‚é¢çš„é«˜å¹¶å‘ä¼˜åŒ–.html-b1767083.js" as="script"><link rel="prefetch" href="/assets/Sharding-JDBCåˆ†åº“åˆ†è¡¨åº”ç”¨å®æˆ˜.html-c0c4ed01.js" as="script"><link rel="prefetch" href="/assets/index.html-e2f05784.js" as="script"><link rel="prefetch" href="/assets/10.ShardingJDBCåˆ†åº“åˆ†è¡¨å®æˆ˜æŒ‡å—.html-d40c40d5.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-4c6f716b.js" as="script"><link rel="prefetch" href="/assets/index.html-519339f5.js" as="script"><link rel="prefetch" href="/assets/index.html-c18428dd.js" as="script"><link rel="prefetch" href="/assets/index.html-07f44b51.js" as="script"><link rel="prefetch" href="/assets/index.html-a624eba4.js" as="script"><link rel="prefetch" href="/assets/index.html-c48fb7bf.js" as="script"><link rel="prefetch" href="/assets/index.html-90d7e407.js" as="script"><link rel="prefetch" href="/assets/index.html-06581ff6.js" as="script"><link rel="prefetch" href="/assets/index.html-ae50071f.js" as="script"><link rel="prefetch" href="/assets/index.html-7fd2c1d7.js" as="script"><link rel="prefetch" href="/assets/index.html-a3aa9d52.js" as="script"><link rel="prefetch" href="/assets/index.html-5be4934b.js" as="script"><link rel="prefetch" href="/assets/index.html-39cba0c1.js" as="script"><link rel="prefetch" href="/assets/index.html-3288f0b7.js" as="script"><link rel="prefetch" href="/assets/index.html-8780dd0c.js" as="script"><link rel="prefetch" href="/assets/index.html-a467bfa9.js" as="script"><link rel="prefetch" href="/assets/index.html-2c6c5ea2.js" as="script"><link rel="prefetch" href="/assets/index.html-07a1b646.js" as="script"><link rel="prefetch" href="/assets/index.html-d75eed32.js" as="script"><link rel="prefetch" href="/assets/index.html-433879d8.js" as="script"><link rel="prefetch" href="/assets/index.html-880aa5b3.js" as="script"><link rel="prefetch" href="/assets/index.html-e876545f.js" as="script"><link rel="prefetch" href="/assets/index.html-c5151dd6.js" as="script"><link rel="prefetch" href="/assets/index.html-ad73073a.js" as="script"><link rel="prefetch" href="/assets/index.html-ecb456de.js" as="script"><link rel="prefetch" href="/assets/index.html-041a51c1.js" as="script"><link rel="prefetch" href="/assets/index.html-228f661f.js" as="script"><link rel="prefetch" href="/assets/index.html-4c6c0b82.js" as="script"><link rel="prefetch" href="/assets/index.html-cf92b798.js" as="script"><link rel="prefetch" href="/assets/index.html-63a5728b.js" as="script"><link rel="prefetch" href="/assets/index.html-d8f8d18f.js" as="script"><link rel="prefetch" href="/assets/index.html-ee028baf.js" as="script"><link rel="prefetch" href="/assets/index.html-67d7e0d7.js" as="script"><link rel="prefetch" href="/assets/index.html-4542f54b.js" as="script"><link rel="prefetch" href="/assets/index.html-e45b0d7c.js" as="script"><link rel="prefetch" href="/assets/index.html-8a3c7439.js" as="script"><link rel="prefetch" href="/assets/index.html-9100611e.js" as="script"><link rel="prefetch" href="/assets/index.html-982db96e.js" as="script"><link rel="prefetch" href="/assets/index.html-75db7947.js" as="script"><link rel="prefetch" href="/assets/index.html-935e2e4c.js" as="script"><link rel="prefetch" href="/assets/index.html-c1486706.js" as="script"><link rel="prefetch" href="/assets/index.html-f4d421e4.js" as="script"><link rel="prefetch" href="/assets/index.html-741750a6.js" as="script"><link rel="prefetch" href="/assets/index.html-459a901f.js" as="script"><link rel="prefetch" href="/assets/index.html-74a206d2.js" as="script"><link rel="prefetch" href="/assets/index.html-1edcf98d.js" as="script"><link rel="prefetch" href="/assets/index.html-860d465c.js" as="script"><link rel="prefetch" href="/assets/index.html-4c9840cd.js" as="script"><link rel="prefetch" href="/assets/index.html-009cbb5a.js" as="script"><link rel="prefetch" href="/assets/index.html-6a627085.js" as="script"><link rel="prefetch" href="/assets/index.html-0001981f.js" as="script"><link rel="prefetch" href="/assets/index.html-8e9ccb9d.js" as="script"><link rel="prefetch" href="/assets/index.html-e3af014b.js" as="script"><link rel="prefetch" href="/assets/index.html-991e95c6.js" as="script"><link rel="prefetch" href="/assets/index.html-a60497e1.js" as="script"><link rel="prefetch" href="/assets/index.html-c93dbbf6.js" as="script"><link rel="prefetch" href="/assets/index.html-85335f63.js" as="script"><link rel="prefetch" href="/assets/Seataäº‹åŠ¡æ¨¡å¼.html-e750a9ca.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-10f3d852.js" as="script"><link rel="prefetch" href="/assets/index.html-225af986.js" as="script"><link rel="prefetch" href="/assets/index.html-af28632d.js" as="script"><link rel="prefetch" href="/assets/index.html-3042fd82.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-9bda0661.js" as="script"><link rel="prefetch" href="/assets/404.html-f74ec574.js" as="script"><link rel="prefetch" href="/assets/index.html-c5e3297b.js" as="script"><link rel="prefetch" href="/assets/index.html-24493dad.js" as="script"><link rel="prefetch" href="/assets/index.html-d8325fa4.js" as="script"><link rel="prefetch" href="/assets/index.html-d016ee37.js" as="script"><link rel="prefetch" href="/assets/index.html-767cfa58.js" as="script"><link rel="prefetch" href="/assets/index.html-936e543d.js" as="script"><link rel="prefetch" href="/assets/index.html-239174d3.js" as="script"><link rel="prefetch" href="/assets/index.html-67b87889.js" as="script"><link rel="prefetch" href="/assets/index.html-8a406f75.js" as="script"><link rel="prefetch" href="/assets/index.html-f4b35969.js" as="script"><link rel="prefetch" href="/assets/index.html-51708553.js" as="script"><link rel="prefetch" href="/assets/index.html-570ecc73.js" as="script"><link rel="prefetch" href="/assets/index.html-9d65b19a.js" as="script"><link rel="prefetch" href="/assets/index.html-3e573cf2.js" as="script"><link rel="prefetch" href="/assets/index.html-bdc5ba4b.js" as="script"><link rel="prefetch" href="/assets/index.html-49d045e2.js" as="script"><link rel="prefetch" href="/assets/index.html-ccb8fb88.js" as="script"><link rel="prefetch" href="/assets/index.html-fa60eb51.js" as="script"><link rel="prefetch" href="/assets/index.html-ffbf75c6.js" as="script"><link rel="prefetch" href="/assets/index.html-35dbd033.js" as="script"><link rel="prefetch" href="/assets/index.html-74ed93fa.js" as="script"><link rel="prefetch" href="/assets/index.html-8a9616f5.js" as="script"><link rel="prefetch" href="/assets/index.html-6f88a53e.js" as="script"><link rel="prefetch" href="/assets/index.html-7d3a4c18.js" as="script"><link rel="prefetch" href="/assets/index.html-1732a879.js" as="script"><link rel="prefetch" href="/assets/index.html-a48cdcb6.js" as="script"><link rel="prefetch" href="/assets/index.html-4b7dec97.js" as="script"><link rel="prefetch" href="/assets/index.html-5be637ac.js" as="script"><link rel="prefetch" href="/assets/index.html-eb906ebe.js" as="script"><link rel="prefetch" href="/assets/index.html-7276c6c9.js" as="script"><link rel="prefetch" href="/assets/index.html-edd3dae5.js" as="script"><link rel="prefetch" href="/assets/index.html-a90d842b.js" as="script"><link rel="prefetch" href="/assets/index.html-c658b86f.js" as="script"><link rel="prefetch" href="/assets/index.html-154ecd8f.js" as="script"><link rel="prefetch" href="/assets/index.html-a8f7d25f.js" as="script"><link rel="prefetch" href="/assets/index.html-2451b953.js" as="script"><link rel="prefetch" href="/assets/index.html-c4ed2fb0.js" as="script"><link rel="prefetch" href="/assets/index.html-3716febc.js" as="script"><link rel="prefetch" href="/assets/index.html-42098412.js" as="script"><link rel="prefetch" href="/assets/index.html-38dbc255.js" as="script"><link rel="prefetch" href="/assets/index.html-00584c59.js" as="script"><link rel="prefetch" href="/assets/index.html-a4aef757.js" as="script"><link rel="prefetch" href="/assets/index.html-b50135f9.js" as="script"><link rel="prefetch" href="/assets/index.html-b470873d.js" as="script"><link rel="prefetch" href="/assets/index.html-4ce33c0c.js" as="script"><link rel="prefetch" href="/assets/index.html-8450ba35.js" as="script"><link rel="prefetch" href="/assets/giscus-52604b1e.js" as="script"><link rel="prefetch" href="/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/assets/index-ae8c1e74.js" as="script"><link rel="prefetch" href="/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-d0065dda.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-aba27bbf.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-2450701e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="å­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">å­¦ä¹ ç¬”è®°</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->å¹¶å‘é”æœºåˆ¶ä¹‹synchronized</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-11-22T00:12:52.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 29 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT29M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category6 clickable" role="navigation">å¹¶å‘ç¼–ç¨‹</span><!--]--><meta property="articleSection" content="å¹¶å‘ç¼–ç¨‹"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#synchronizedåŸºç¡€ç¯‡" class="router-link-active router-link-exact-active toc-link level2">synchronizedåŸºç¡€ç¯‡</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#javaå…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="router-link-active router-link-exact-active toc-link level3">Javaå…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#synchronizedçš„ä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level3">synchronizedçš„ä½¿ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#synchronizedé«˜çº§ç¯‡" class="router-link-active router-link-exact-active toc-link level2">synchronizedé«˜çº§ç¯‡</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#synchronizedåº•å±‚åŸç†" class="router-link-active router-link-exact-active toc-link level3">synchronizedåº•å±‚åŸç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#monitor-ç®¡ç¨‹-ç›‘è§†å™¨" class="router-link-active router-link-exact-active toc-link level3">Monitorï¼ˆç®¡ç¨‹/ç›‘è§†å™¨ï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#javaè¯­è¨€çš„å†…ç½®ç®¡ç¨‹synchronized" class="router-link-active router-link-exact-active toc-link level3">Javaè¯­è¨€çš„å†…ç½®ç®¡ç¨‹synchronized</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="router-link-active router-link-exact-active toc-link level3">å¯¹è±¡çš„å†…å­˜å¸ƒå±€</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#synchronizedé”ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level2">synchronizedé”ä¼˜åŒ–</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#åå‘é”æ‰¹é‡é‡åå‘-æ‰¹é‡æ’¤é”€" class="router-link-active router-link-exact-active toc-link level3">åå‘é”æ‰¹é‡é‡åå‘&amp;æ‰¹é‡æ’¤é”€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#è‡ªæ—‹ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level3">è‡ªæ—‹ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#é”ç²—åŒ–" class="router-link-active router-link-exact-active toc-link level3">é”ç²—åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/ed8c1f/#é”æ¶ˆé™¤" class="router-link-active router-link-exact-active toc-link level3">é”æ¶ˆé™¤</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="synchronizedåŸºç¡€ç¯‡" tabindex="-1"><a class="header-anchor" href="#synchronizedåŸºç¡€ç¯‡" aria-hidden="true">#</a> synchronizedåŸºç¡€ç¯‡</h2><h3 id="javaå…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#javaå…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" aria-hidden="true">#</a> Javaå…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p><strong>æ€è€ƒï¼š ä¸¤ä¸ªçº¿ç¨‹å¯¹åˆå§‹å€¼ä¸º 0 çš„é™æ€å˜é‡ä¸€ä¸ªåšè‡ªå¢ï¼Œä¸€ä¸ªåšè‡ªå‡ï¼Œå„åš 5000 æ¬¡ï¼Œç»“æœæ˜¯ 0 å—ï¼Ÿ</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SyncDemo</span> <span class="token punctuation">{</span>
   
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counter<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ€è€ƒï¼š counter=ï¼Ÿ</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>       
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é—®é¢˜åˆ†æ</strong></p><p>ä»¥ä¸Šçš„ç»“æœå¯èƒ½æ˜¯æ­£æ•°ã€è´Ÿæ•°ã€é›¶ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º Java ä¸­å¯¹é™æ€å˜é‡çš„è‡ªå¢ï¼Œè‡ªå‡å¹¶ä¸æ˜¯åŸå­æ“ä½œã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ i++å’Œ i--ï¼ˆi ä¸ºé™æ€å˜é‡ï¼‰çš„ JVM å­—èŠ‚ç æŒ‡ä»¤ ï¼ˆ å¯ä»¥åœ¨ideaä¸­å®‰è£…ä¸€ä¸ªjclasslibæ’ä»¶ï¼‰</p><p><strong>i++çš„JVM å­—èŠ‚ç æŒ‡ä»¤</strong></p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>getstatic i <span class="token comment">// è·å–é™æ€å˜é‡içš„å€¼ </span>
iconst_1 <span class="token comment">// å°†intå¸¸é‡1å‹å…¥æ“ä½œæ•°æ ˆ</span>
iadd <span class="token comment">// è‡ªå¢ </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>i--çš„JVM å­—èŠ‚ç æŒ‡ä»¤</strong></p><div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="language-c++"><code>getstatic i // è·å–é™æ€å˜é‡içš„å€¼ 
iconst_1 // å°†intå¸¸é‡1å‹å…¥æ“ä½œæ•°æ ˆ
isub // è‡ªå‡ 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ˜¯å•çº¿ç¨‹ä»¥ä¸Š 8 è¡Œä»£ç æ˜¯é¡ºåºæ‰§è¡Œï¼ˆä¸ä¼šäº¤é”™ï¼‰æ²¡æœ‰é—®é¢˜ã€‚</p><p>ä½†å¤šçº¿ç¨‹ä¸‹è¿™ 8 è¡Œä»£ç å¯èƒ½äº¤é”™è¿è¡Œï¼š <img src="https://img.jssjqd.cn/202211221253550.png" alt="image-20221122125343370" loading="lazy"></p><p><strong>ä¸´ç•ŒåŒºï¼ˆ Critical Sectionï¼‰</strong></p><p>ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„</p><p>é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº</p><ul><li>å¤šä¸ªçº¿ç¨‹è¯»å…±äº«èµ„æºå…¶å®ä¹Ÿæ²¡æœ‰é—®é¢˜</li><li>åœ¨å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜</li></ul><p><strong>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸ºä¸´ç•ŒåŒºï¼Œå…¶å…±äº«èµ„æºä¸ºä¸´ç•Œèµ„æº</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ä¸´ç•Œèµ„æº</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//ä¸´ç•ŒåŒº</span>
    counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//ä¸´ç•ŒåŒº</span>
    counter<span class="token operator">--</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç«æ€æ¡ä»¶ï¼ˆ Race Condition ï¼‰</strong></p><p><strong>å¤šä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†ç«æ€æ¡ä»¶</strong></p><p>ä¸ºäº†é¿å…ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ï¼š</p><ul><li><strong>é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼ŒLock</strong></li><li><strong>éé˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šåŸå­å˜é‡</strong></li></ul><p><strong>æ³¨æ„ï¼š</strong></p><p>è™½ç„¶ java ä¸­äº’æ–¥å’ŒåŒæ­¥éƒ½å¯ä»¥é‡‡ç”¨ synchronized å…³é”®å­—æ¥å®Œæˆï¼Œä½†å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š</p><p>äº’æ–¥æ˜¯ä¿è¯ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </p><p>åŒæ­¥æ˜¯ç”±äºçº¿ç¨‹æ‰§è¡Œçš„å…ˆåã€é¡ºåºä¸åŒã€éœ€è¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹</p><h3 id="synchronizedçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#synchronizedçš„ä½¿ç”¨" aria-hidden="true">#</a> synchronizedçš„ä½¿ç”¨</h3><p>synchronized åŒæ­¥å—æ˜¯ Java æä¾›çš„ä¸€ç§åŸå­æ€§å†…ç½®é”ï¼ŒJava ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥æŠŠå®ƒå½“ä½œä¸€ä¸ªåŒæ­¥é”æ¥ä½¿ç”¨ï¼Œè¿™äº› Java å†…ç½®çš„ä½¿ç”¨è€…çœ‹ä¸åˆ°çš„é”è¢«ç§°ä¸ºå†…ç½®é”ï¼Œä¹Ÿå«ä½œç›‘è§†å™¨é”ã€‚</p><p><strong>åŠ é”æ–¹å¼</strong></p><figure><img src="https://img.jssjqd.cn/202211221257670.png" alt="image-20221122125704432" tabindex="0" loading="lazy"><figcaption>image-20221122125704432</figcaption></figure><p><strong>è§£å†³ä¹‹å‰çš„å…±äº«é—®é¢˜</strong></p><p>æ–¹å¼ä¸€</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counter<span class="token operator">--</span><span class="token punctuation">;</span>            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–¹å¼äºŒ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> lock <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counter<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>       
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>synchronized å®é™…æ˜¯ç”¨å¯¹è±¡é”ä¿è¯äº†ä¸´ç•ŒåŒºå†…ä»£ç çš„åŸå­æ€§</p><p>â€‹ <img src="https://img.jssjqd.cn/202211221257745.png" alt="image-20221122125755419" loading="lazy"></p><h2 id="synchronizedé«˜çº§ç¯‡" tabindex="-1"><a class="header-anchor" href="#synchronizedé«˜çº§ç¯‡" aria-hidden="true">#</a> synchronizedé«˜çº§ç¯‡</h2><h3 id="synchronizedåº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#synchronizedåº•å±‚åŸç†" aria-hidden="true">#</a> synchronizedåº•å±‚åŸç†</h3><p>synchronizedæ˜¯JVMå†…ç½®é”ï¼ŒåŸºäº<strong>Monitor</strong>æœºåˆ¶å®ç°ï¼Œä¾èµ–åº•å±‚æ“ä½œç³»ç»Ÿçš„äº’æ–¥åŸè¯­Mutexï¼ˆäº’æ–¥é‡ï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªé‡é‡çº§é”ï¼Œæ€§èƒ½è¾ƒä½ã€‚å½“ç„¶ï¼ŒJVMå†…ç½®é”åœ¨1.5ä¹‹åç‰ˆæœ¬åšäº†é‡å¤§çš„ä¼˜åŒ–ï¼Œå¦‚é”ç²—åŒ–ï¼ˆLock Coarseningï¼‰ã€é”æ¶ˆé™¤ï¼ˆLock Eliminationï¼‰ã€è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰ã€åå‘é”ï¼ˆBiased Lockingï¼‰ã€è‡ªé€‚åº”è‡ªæ—‹ï¼ˆAdaptive Spinningï¼‰ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ï¼Œå†…ç½®é”çš„å¹¶å‘æ€§èƒ½å·²ç»åŸºæœ¬ä¸LockæŒå¹³ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>The JavaÂ® Language Specification

Each object is associated with a monitor (Â§17.1), which is used by synchronized methods (Â§8.4.3) and the synchronized statement (Â§14.19) to provide control over concurrent access to state by multiple threads (Â§17 (Threads and Locks)).

The JavaÂ® Virtual Machine Specification

The Java Virtual Machine supports synchronization of both methods and sequences of instructions within a method by a single synchronization construct: the monitor.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Javaè™šæ‹Ÿæœºé€šè¿‡ä¸€ä¸ªåŒæ­¥ç»“æ„æ”¯æŒæ–¹æ³•å’Œæ–¹æ³•ä¸­çš„æŒ‡ä»¤åºåˆ—çš„åŒæ­¥ï¼šmonitorã€‚</strong></p><p>åŒæ­¥æ–¹æ³•æ˜¯é€šè¿‡æ–¹æ³•ä¸­çš„access_flagsä¸­è®¾ç½®<strong>ACC_SYNCHRONIZED</strong>æ ‡å¿—æ¥å®ç°ï¼›åŒæ­¥ä»£ç å—æ˜¯é€šè¿‡monitorenterå’Œmonitorexitæ¥å®ç°ã€‚ä¸¤ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œæ˜¯JVMé€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿçš„äº’æ–¥åŸè¯­mutexæ¥å®ç°ï¼Œè¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€ç­‰å¾…é‡æ–°è°ƒåº¦ï¼Œä¼šå¯¼è‡´â€œç”¨æˆ·æ€å’Œå†…æ ¸æ€â€ä¸¤ä¸ªæ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œå¯¹æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ã€‚</p><p><strong>æŸ¥çœ‹synchronizedçš„å­—èŠ‚ç æŒ‡ä»¤åºåˆ—</strong></p><p>Method access and property flagsï¼š</p><figure><img src="https://img.jssjqd.cn/202211221302947.png" alt="image-20221122130159899" tabindex="0" loading="lazy"><figcaption>image-20221122130159899</figcaption></figure><p>â€‹ <img src="https://img.jssjqd.cn/202211221302128.png" alt="image-20221122130213875" loading="lazy"></p><h3 id="monitor-ç®¡ç¨‹-ç›‘è§†å™¨" tabindex="-1"><a class="header-anchor" href="#monitor-ç®¡ç¨‹-ç›‘è§†å™¨" aria-hidden="true">#</a> Monitorï¼ˆç®¡ç¨‹/ç›‘è§†å™¨ï¼‰</h3><p>Monitorï¼Œç›´è¯‘ä¸ºâ€œç›‘è§†å™¨â€ï¼Œè€Œæ“ä½œç³»ç»Ÿé¢†åŸŸä¸€èˆ¬ç¿»è¯‘ä¸ºâ€œç®¡ç¨‹â€ã€‚ç®¡ç¨‹æ˜¯æŒ‡<strong>ç®¡ç†å…±äº«å˜é‡ä»¥åŠå¯¹å…±äº«å˜é‡æ“ä½œçš„è¿‡ç¨‹</strong>ï¼Œè®©å®ƒä»¬æ”¯æŒå¹¶å‘ã€‚åœ¨Java 1.5ä¹‹å‰ï¼ŒJavaè¯­è¨€æä¾›çš„å”¯ä¸€å¹¶å‘è¯­è¨€å°±æ˜¯ç®¡ç¨‹ï¼ŒJava 1.5ä¹‹åæä¾›çš„SDKå¹¶å‘åŒ…ä¹Ÿæ˜¯ä»¥ç®¡ç¨‹ä¸ºåŸºç¡€çš„ã€‚é™¤äº†Javaä¹‹å¤–ï¼ŒC/C++ã€C#ç­‰é«˜çº§è¯­è¨€ä¹Ÿéƒ½æ˜¯æ”¯æŒç®¡ç¨‹çš„ã€‚synchronizedå…³é”®å­—å’Œ**wait()ã€notify()ã€notifyAll()**è¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯Javaä¸­å®ç°ç®¡ç¨‹æŠ€æœ¯çš„ç»„æˆéƒ¨åˆ†ã€‚</p><p><strong>MESAæ¨¡å‹</strong></p><p>åœ¨ç®¡ç¨‹çš„å‘å±•å²ä¸Šï¼Œå…ˆåå‡ºç°è¿‡ä¸‰ç§ä¸åŒçš„ç®¡ç¨‹æ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯Hasenæ¨¡å‹ã€Hoareæ¨¡å‹å’ŒMESAæ¨¡å‹ã€‚ç°åœ¨æ­£åœ¨å¹¿æ³›ä½¿ç”¨çš„æ˜¯MESAæ¨¡å‹ã€‚ä¸‹é¢æˆ‘ä»¬ä¾¿ä»‹ç»MESAæ¨¡å‹ï¼š</p><p>â€‹ <img src="https://img.jssjqd.cn/202211221302013.png" alt="image-20221122130220867" loading="lazy"></p><p>ç®¡ç¨‹ä¸­å¼•å…¥äº†æ¡ä»¶å˜é‡çš„æ¦‚å¿µï¼Œè€Œä¸”æ¯ä¸ªæ¡ä»¶å˜é‡éƒ½å¯¹åº”æœ‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ã€‚æ¡ä»¶å˜é‡å’Œç­‰å¾…é˜Ÿåˆ—çš„ä½œç”¨æ˜¯è§£å†³çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥é—®é¢˜ã€‚</p><p><strong>wait()çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿</strong></p><p>å¯¹äºMESAç®¡ç¨‹æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªç¼–ç¨‹èŒƒå¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">while</span><span class="token punctuation">(</span>æ¡ä»¶ä¸æ»¡è¶³<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å”¤é†’çš„æ—¶é—´å’Œè·å–åˆ°é”ç»§ç»­æ‰§è¡Œçš„æ—¶é—´æ˜¯ä¸ä¸€è‡´çš„ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å†æ¬¡æ‰§è¡Œæ—¶å¯èƒ½æ¡ä»¶åˆä¸æ»¡è¶³äº†ï¼Œæ‰€ä»¥å¾ªç¯æ£€éªŒæ¡ä»¶ã€‚MESAæ¨¡å‹çš„wait()æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œä¸ºäº†é¿å…çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ—æ°¸ä¹…é˜»å¡ã€‚</p><p><strong>notify()å’ŒnotifyAll()åˆ†åˆ«ä½•æ—¶ä½¿ç”¨</strong></p><p>æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨notify()ï¼Œå…¶ä½™æƒ…å†µå°½é‡ä½¿ç”¨notifyAll()ï¼š</p><ol><li>æ‰€æœ‰ç­‰å¾…çº¿ç¨‹æ‹¥æœ‰ç›¸åŒçš„ç­‰å¾…æ¡ä»¶ï¼›</li><li>æ‰€æœ‰ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’åï¼Œæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼›</li><li>åªéœ€è¦å”¤é†’ä¸€ä¸ªçº¿ç¨‹ã€‚</li></ol><h3 id="javaè¯­è¨€çš„å†…ç½®ç®¡ç¨‹synchronized" tabindex="-1"><a class="header-anchor" href="#javaè¯­è¨€çš„å†…ç½®ç®¡ç¨‹synchronized" aria-hidden="true">#</a> Javaè¯­è¨€çš„å†…ç½®ç®¡ç¨‹synchronized</h3><p>Java å‚è€ƒäº† MESA æ¨¡å‹ï¼Œè¯­è¨€å†…ç½®çš„ç®¡ç¨‹ï¼ˆsynchronizedï¼‰å¯¹ MESA æ¨¡å‹è¿›è¡Œäº†ç²¾ç®€ã€‚MESA æ¨¡å‹ä¸­ï¼Œæ¡ä»¶å˜é‡å¯ä»¥æœ‰å¤šä¸ªï¼ŒJava è¯­è¨€å†…ç½®çš„ç®¡ç¨‹é‡Œåªæœ‰ä¸€ä¸ªæ¡ä»¶å˜é‡ã€‚æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><figure><img src="https://img.jssjqd.cn/202211221314524.png" alt="image-20221122131456429" tabindex="0" loading="lazy"><figcaption>image-20221122131456429</figcaption></figure><p><strong>Monitoræœºåˆ¶åœ¨Javaä¸­çš„å®ç°</strong></p><p>java.lang.Object ç±»å®šä¹‰äº† wait()ï¼Œnotify()ï¼ŒnotifyAll() æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œä¾èµ–äº ObjectMonitor å®ç°ï¼Œè¿™æ˜¯ JVM å†…éƒ¨åŸºäº C++ å®ç°çš„ä¸€å¥—æœºåˆ¶ã€‚</p><p>ObjectMonitorå…¶ä¸»è¦æ•°æ®ç»“æ„å¦‚ä¸‹ï¼ˆhotspotæºç ObjectMonitor.hppï¼‰ï¼š</p><div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="language-c++"><code>ObjectMonitor() {
    _header       = NULL; //å¯¹è±¡å¤´  markOop
    _count        = 0;  
    _waiters      = 0,   
    _recursions   = 0;   // é”çš„é‡å…¥æ¬¡æ•° 
    _object       = NULL;  //å­˜å‚¨é”å¯¹è±¡
    _owner        = NULL;  // æ ‡è¯†æ‹¥æœ‰è¯¥monitorçš„çº¿ç¨‹ï¼ˆå½“å‰è·å–é”çš„çº¿ç¨‹ï¼‰ 
    _WaitSet      = NULL;  // ç­‰å¾…çº¿ç¨‹ï¼ˆè°ƒç”¨waitï¼‰ç»„æˆçš„åŒå‘å¾ªç¯é“¾è¡¨ï¼Œ_WaitSetæ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
    _WaitSetLock  = 0 ;    
    _Responsible  = NULL ;
    _succ         = NULL ;
    _cxq          = NULL ; //å¤šçº¿ç¨‹ç«äº‰é”ä¼šå…ˆå­˜åˆ°è¿™ä¸ªå•å‘é“¾è¡¨ä¸­ ï¼ˆFILOæ ˆç»“æ„ï¼‰
    FreeNext      = NULL ;
    _EntryList    = NULL ; //å­˜æ”¾åœ¨è¿›å…¥æˆ–é‡æ–°è¿›å…¥æ—¶è¢«é˜»å¡(blocked)çš„çº¿ç¨‹ (ä¹Ÿæ˜¯å­˜ç«äº‰é”å¤±è´¥çš„çº¿ç¨‹)
    _SpinFreq     = 0 ;
    _SpinClock    = 0 ;
    OwnerIsThread = 0 ;
    _previous_owner_tid = 0;  
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>å„ä¸ªçº¿ç¨‹é€šè¿‡caså»ä¿®æ”¹ObjectMonitorä¸­owerå­—æ®µï¼Œè°ä¿®æ”¹æˆåŠŸè¡¨ç¤ºè°æŠ¢åˆ°é”äº†ï¼Œå¦‚æœå¤±è´¥äº†ä¼šcasåŠ å…¥cxqä¸­ï¼Œcxqæ˜¯æ ˆç»“æ„ã€‚</li><li>waitï¼ˆï¼‰æ–¹æ³•ä¼šä½¿å¾—å½“å‰çš„çº¿ç¨‹è¿›åˆ°waitSeté˜Ÿåˆ—ä¸­ï¼Œwaitsetæ˜¯ç¯å½¢åŒå‘é“¾è¡¨</li><li>notifyï¼ˆï¼‰æ–¹æ³•å…¶å®å°±æ˜¯ç§»åŠ¨waitSetä¸­çš„çº¿ç¨‹è¦ä¹ˆåˆ°cxqæˆ–è€…entrylistä¸­ï¼Œå½“åŒæ­¥æ–¹æ³•ç»“æŸçš„æ—¶å€™ä¼šè§¦å‘å”¤é†’æœºåˆ¶ï¼Œæ ¹æ®Qmodeä¸åŒç±»å‹è¿›è¡Œä¸åŒçš„è§„åˆ™å”¤é†’ã€‚</li></ol><figure><img src="https://img.jssjqd.cn/202211221315475.png" alt="image-20221122131528461" tabindex="0" loading="lazy"><figcaption>image-20221122131528461</figcaption></figure><p>åœ¨è·å–é”æ—¶ï¼Œæ˜¯å°†å½“å‰çº¿ç¨‹æ’å…¥åˆ°cxqçš„å¤´éƒ¨ï¼Œè€Œé‡Šæ”¾é”æ—¶ï¼Œé»˜è®¤ç­–ç•¥ï¼ˆQMode=0ï¼‰æ˜¯ï¼šå¦‚æœEntryListä¸ºç©ºï¼Œåˆ™å°†cxqä¸­çš„å…ƒç´ æŒ‰åŸæœ‰é¡ºåºæ’å…¥åˆ°EntryListï¼Œå¹¶å”¤é†’ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯å½“EntryListä¸ºç©ºæ—¶ï¼Œæ˜¯åæ¥çš„çº¿ç¨‹å…ˆè·å–é”ã€‚_EntryListä¸ä¸ºç©ºï¼Œç›´æ¥ä»_EntryListä¸­å”¤é†’çº¿ç¨‹ã€‚</p><p><strong>æ€è€ƒï¼šsynchronizedåŠ é”åŠ åœ¨å¯¹è±¡ä¸Šï¼Œé”å¯¹è±¡æ˜¯å¦‚ä½•è®°å½•é”çŠ¶æ€çš„ï¼Ÿ</strong></p><h3 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡çš„å†…å­˜å¸ƒå±€" aria-hidden="true">#</a> å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h3><p>Hotspotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼š<strong>å¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰</strong>ã€‚</p><ul><li>å¯¹è±¡å¤´ï¼šæ¯”å¦‚ hashç ï¼Œå¯¹è±¡æ‰€å±çš„å¹´ä»£ï¼Œå¯¹è±¡é”ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œåå‘é”ï¼ˆçº¿ç¨‹ï¼‰IDï¼Œåå‘æ—¶é—´ï¼Œæ•°ç»„é•¿åº¦ï¼ˆæ•°ç»„å¯¹è±¡æ‰æœ‰ï¼‰ç­‰ã€‚</li><li>å®ä¾‹æ•°æ®ï¼šå­˜æ”¾ç±»çš„å±æ€§æ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„å±æ€§ä¿¡æ¯ï¼›</li><li>å¯¹é½å¡«å……ï¼šç”±äºè™šæ‹Ÿæœºè¦æ±‚ <strong>å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€</strong>ã€‚å¡«å……æ•°æ®ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œä»…ä»…æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½ã€‚</li></ul><p>â€‹ <img src="https://img.jssjqd.cn/202211221315114.png" alt="image-20221122131539127" loading="lazy"></p><p><strong>å¯¹è±¡å¤´è¯¦è§£</strong></p><p>HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ï¼š</p><ul><li>Mark Word</li></ul><p>ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºä¸­åˆ†åˆ«ä¸º32bitå’Œ64bitï¼Œå®˜æ–¹ç§°å®ƒä¸ºâ€œMark Wordâ€ã€‚</p><ul><li>Klass Pointer</li></ul><p>å¯¹è±¡å¤´çš„å¦å¤–ä¸€éƒ¨åˆ†æ˜¯klassç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ 32ä½4å­—èŠ‚ï¼Œ64ä½å¼€å¯æŒ‡é’ˆå‹ç¼©æˆ–æœ€å¤§å †å†…å­˜&lt;32gæ—¶4å­—èŠ‚ï¼Œå¦åˆ™8å­—èŠ‚ã€‚jdk1.8é»˜è®¤å¼€å¯æŒ‡é’ˆå‹ç¼©åä¸º4å­—èŠ‚ï¼Œå½“åœ¨JVMå‚æ•°ä¸­å…³é—­æŒ‡é’ˆå‹ç¼©ï¼ˆ-XX:-UseCompressedOopsï¼‰åï¼Œé•¿åº¦ä¸º8å­—èŠ‚ã€‚</p><ul><li>æ•°ç»„é•¿åº¦ï¼ˆåªæœ‰æ•°ç»„å¯¹è±¡æœ‰ï¼‰</li></ul><p>å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„, é‚£åœ¨å¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—æ•°æ®ç”¨äºè®°å½•æ•°ç»„é•¿åº¦ã€‚ 4å­—èŠ‚</p><p>â€‹ <img src="https://img.jssjqd.cn/202211221315329.png" alt="image-20221122131546476" loading="lazy"></p><p><strong>ä½¿ç”¨JOLå·¥å…·æŸ¥çœ‹å†…å­˜å¸ƒå±€</strong></p><p>ç»™å¤§å®¶æ¨èä¸€ä¸ªå¯ä»¥æŸ¥çœ‹æ™®é€šjavaå¯¹è±¡çš„å†…éƒ¨å¸ƒå±€å·¥å…·JOL(JAVA OBJECT LAYOUT)ï¼Œä½¿ç”¨æ­¤å·¥å…·å¯ä»¥æŸ¥çœ‹newå‡ºæ¥çš„ä¸€ä¸ªjavaå¯¹è±¡çš„å†…éƒ¨å¸ƒå±€,ä»¥åŠä¸€ä¸ªæ™®é€šçš„javaå¯¹è±¡å ç”¨å¤šå°‘å­—èŠ‚ã€‚</p><p><strong>å¼•å…¥mavenä¾èµ–</strong></p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- æŸ¥çœ‹Java å¯¹è±¡å¸ƒå±€ã€å¤§å°å·¥å…· --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjdk.jol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jol-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨æ–¹æ³•</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//æŸ¥çœ‹å¯¹è±¡å†…éƒ¨ä¿¡æ¯              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æŸ¥çœ‹å¯¹è±¡å†…éƒ¨ä¿¡æ¯</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>åˆ©ç”¨jolæŸ¥çœ‹64ä½ç³»ç»Ÿjavaå¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼Œé»˜è®¤å¼€å¯æŒ‡é’ˆå‹ç¼©ï¼Œæ€»å¤§å°æ˜¾ç¤º16å­—èŠ‚ï¼Œå‰12å­—èŠ‚ä¸ºå¯¹è±¡å¤´</li></ol><figure><img src="https://img.jssjqd.cn/202211221317804.png" alt="image-20221122131727550" tabindex="0" loading="lazy"><figcaption>image-20221122131727550</figcaption></figure><ul><li>OFFSETï¼šåç§»åœ°å€ï¼Œå•ä½å­—èŠ‚ï¼›</li><li>SIZEï¼šå ç”¨çš„å†…å­˜å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼›</li><li>TYPE DESCRIPTIONï¼šç±»å‹æè¿°ï¼Œå…¶ä¸­object headerä¸ºå¯¹è±¡å¤´ï¼›</li><li>VALUEï¼šå¯¹åº”å†…å­˜ä¸­å½“å‰å­˜å‚¨çš„å€¼ï¼ŒäºŒè¿›åˆ¶32ä½ï¼›</li></ul><ol start="2"><li>å…³é—­æŒ‡é’ˆå‹ç¼©åï¼Œå¯¹è±¡å¤´ä¸º16å­—èŠ‚ï¼š-XX:-UseCompressedOops <img src="https://img.jssjqd.cn/202211221317353.png" alt="image-20221122131737211" loading="lazy"></li></ol><p>æ€è€ƒï¼š ä¸‹é¢ä¾‹å­ä¸­objå¯¹è±¡å å¤šå°‘ä¸ªå­—èŠ‚?</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æŸ¥çœ‹å¯¹è±¡å†…éƒ¨ä¿¡æ¯</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> p<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›åˆ°ä¹‹å‰çš„é—®é¢˜ï¼š <strong>synchronizedåŠ é”åŠ åœ¨å¯¹è±¡ä¸Šï¼Œå¯¹è±¡æ˜¯å¦‚ä½•è®°å½•é”çŠ¶æ€çš„ï¼Ÿ</strong></p><p>é”çŠ¶æ€è¢«è®°å½•åœ¨æ¯ä¸ªå¯¹è±¡çš„å¯¹è±¡å¤´çš„<strong>Mark Word</strong>ä¸­</p><p><strong>Mark Wordæ˜¯å¦‚ä½•è®°å½•é”çŠ¶æ€çš„</strong></p><p>Hotspoté€šè¿‡markOopç±»å‹å®ç°Mark Wordï¼Œå…·ä½“å®ç°ä½äºmarkOop.hppæ–‡ä»¶ä¸­ã€‚ç”±äºå¯¹è±¡éœ€è¦å­˜å‚¨çš„è¿è¡Œæ—¶æ•°æ®å¾ˆå¤šï¼Œè€ƒè™‘åˆ°è™šæ‹Ÿæœºçš„å†…å­˜ä½¿ç”¨ï¼ŒmarkOopè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ï¼Œä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ï¼Œæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ã€‚</p><p>ç®€å•ç‚¹ç†è§£å°±æ˜¯ï¼šMarkWord ç»“æ„æå¾—è¿™ä¹ˆå¤æ‚ï¼Œæ˜¯å› ä¸ºéœ€è¦èŠ‚çœå†…å­˜ï¼Œè®©åŒä¸€ä¸ªå†…å­˜åŒºåŸŸåœ¨ä¸åŒé˜¶æ®µæœ‰ä¸åŒçš„ç”¨å¤„ã€‚</p><p><strong>Mark Wordçš„ç»“æ„</strong></p><div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="language-c++"><code>//  32 bits:
//  --------
//             hash:25 ------------&gt;| age:4    biased_lock:1 lock:2 (normal object)
//             JavaThread*:23 epoch:2 age:4    biased_lock:1 lock:2 (biased object)
//             size:32 ------------------------------------------&gt;| (CMS free block)
//             PromotedObject*:29 ----------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)
//
//  64 bits:
//  --------
//  unused:25 hash:31 --&gt;| unused:1   age:4    biased_lock:1 lock:2 (normal object)
//  JavaThread*:54 epoch:2 unused:1   age:4    biased_lock:1 lock:2 (biased object)
//  PromotedObject*:61 ---------------------&gt;| promo_bits:3 -----&gt;| (CMS promoted object)
//  size:64 -----------------------------------------------------&gt;| (CMS free block)
//
//  unused:25 hash:31 --&gt;| cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; normal object)
//  JavaThread*:54 epoch:2 cms_free:1 age:4    biased_lock:1 lock:2 (COOPs &amp;&amp; biased object)
//  narrowOop:32 unused:24 cms_free:1 unused:4 promo_bits:3 -----&gt;| (COOPs &amp;&amp; CMS promoted object)
//  unused:21 size:35 --&gt;| cms_free:1 unused:7 ------------------&gt;| (COOPs &amp;&amp; CMS free block)

ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
//    [JavaThread* | epoch | age | 1 | 01]       lock is biased toward given thread
//    [0           | epoch | age | 1 | 01]       lock is anonymously biased
//
//  - the two lock bits are used to describe three states: locked/unlocked and monitor.
//
//    [ptr             | 00]  locked             ptr points to real header on stack
//    [header      | 0 | 01]  unlocked           regular object header
//    [ptr             | 10]  monitor            inflated lock (header is wapped out)
//    [ptr             | 11]  marked             used by markSweep to mark an object          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>hashï¼š ä¿å­˜å¯¹è±¡çš„å“ˆå¸Œç ã€‚è¿è¡ŒæœŸé—´è°ƒç”¨System.identityHashCode()æ¥è®¡ç®—ï¼Œå»¶è¿Ÿè®¡ç®—ï¼Œå¹¶æŠŠç»“æœèµ‹å€¼åˆ°è¿™é‡Œã€‚</li><li>ageï¼š ä¿å­˜å¯¹è±¡çš„åˆ†ä»£å¹´é¾„ã€‚è¡¨ç¤ºå¯¹è±¡è¢«GCçš„æ¬¡æ•°ï¼Œå½“è¯¥æ¬¡æ•°åˆ°è¾¾é˜ˆå€¼çš„æ—¶å€™ï¼Œå¯¹è±¡å°±ä¼šè½¬ç§»åˆ°è€å¹´ä»£ã€‚</li><li>biased_lockï¼š åå‘é”æ ‡è¯†ä½ã€‚ç”±äºæ— é”å’Œåå‘é”çš„é”æ ‡è¯†éƒ½æ˜¯01ï¼Œæ²¡åŠæ³•åŒºåˆ†ï¼Œè¿™é‡Œå¼•å…¥ä¸€ä½çš„åå‘é”æ ‡è¯†ä½ã€‚</li><li>lockï¼š é”çŠ¶æ€æ ‡è¯†ä½ã€‚åŒºåˆ†é”çŠ¶æ€ï¼Œæ¯”å¦‚11æ—¶è¡¨ç¤ºå¯¹è±¡å¾…GCå›æ”¶çŠ¶æ€, åªæœ‰æœ€å2ä½é”æ ‡è¯†(11)æœ‰æ•ˆã€‚</li><li>JavaThreadï¼š ä¿å­˜æŒæœ‰åå‘é”çš„çº¿ç¨‹IDã€‚åå‘æ¨¡å¼çš„æ—¶å€™ï¼Œå½“æŸä¸ªçº¿ç¨‹æŒæœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡è¿™é‡Œå°±ä¼šè¢«ç½®ä¸ºè¯¥çº¿ç¨‹çš„IDã€‚ åœ¨åé¢çš„æ“ä½œä¸­ï¼Œå°±æ— éœ€å†è¿›è¡Œå°è¯•è·å–é”çš„åŠ¨ä½œã€‚è¿™ä¸ªçº¿ç¨‹IDå¹¶ä¸æ˜¯JVMåˆ†é…çš„çº¿ç¨‹IDå·ï¼Œå’ŒJava Threadä¸­çš„IDæ˜¯ä¸¤ä¸ªæ¦‚å¿µã€‚</li><li>epochï¼š ä¿å­˜åå‘æ—¶é—´æˆ³ã€‚åå‘é”åœ¨CASé”æ“ä½œè¿‡ç¨‹ä¸­ï¼Œåå‘æ€§æ ‡è¯†ï¼Œè¡¨ç¤ºå¯¹è±¡æ›´åå‘å“ªä¸ªé”ã€‚</li></ul><p><strong>32ä½JVMä¸‹çš„å¯¹è±¡ç»“æ„æè¿°</strong></p><p>â€‹ <img src="https://img.jssjqd.cn/202211221318403.png" alt="image-20221122131826340" loading="lazy"></p><p><strong>64ä½JVMä¸‹çš„å¯¹è±¡ç»“æ„æè¿°</strong></p><p>â€‹ <img src="https://img.jssjqd.cn/202211221318066.png" alt="image-20221122131831275" loading="lazy"></p><ul><li>ptr_to_lock_recordï¼šè½»é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆã€‚å½“é”è·å–æ˜¯æ— ç«äº‰æ—¶ï¼ŒJVMä½¿ç”¨åŸå­æ“ä½œè€Œä¸æ˜¯OSäº’æ–¥ï¼Œè¿™ç§æŠ€æœ¯ç§°ä¸ºè½»é‡çº§é”å®šã€‚åœ¨è½»é‡çº§é”å®šçš„æƒ…å†µä¸‹ï¼ŒJVMé€šè¿‡CASæ“ä½œåœ¨å¯¹è±¡çš„Mark Wordä¸­è®¾ç½®æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚</li><li>ptr_to_heavyweight_monitorï¼šé‡é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘å¯¹è±¡ç›‘è§†å™¨Monitorçš„æŒ‡é’ˆã€‚å¦‚æœä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åŒæ—¶åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šç«äº‰ï¼Œåˆ™å¿…é¡»å°†è½»é‡çº§é”å®šå‡çº§åˆ°Monitorä»¥ç®¡ç†ç­‰å¾…çš„çº¿ç¨‹ã€‚åœ¨é‡é‡çº§é”å®šçš„æƒ…å†µä¸‹ï¼ŒJVMåœ¨å¯¹è±¡çš„ptr_to_heavyweight_monitorè®¾ç½®æŒ‡å‘Monitorçš„æŒ‡é’ˆ</li></ul><p><strong>Mark Wordä¸­é”æ ‡è®°æšä¸¾</strong></p><div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="language-c++"><code>enum { locked_value             = 0,    //00 è½»é‡çº§é” 
         unlocked_value           = 1,   //001 æ— é”
         monitor_value            = 2,   //10 ç›‘è§†å™¨é”ï¼Œä¹Ÿå«è†¨èƒ€é”ï¼Œä¹Ÿå«é‡é‡çº§é”
         marked_value             = 3,   //11 GCæ ‡è®°
         biased_lock_pattern      = 5    //101 åå‘é”          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ›´ç›´è§‚çš„ç†è§£æ–¹å¼ï¼š</p><p>â€‹ <img src="https://img.jssjqd.cn/202211221318888.png" alt="image-20221122131854928" loading="lazy"></p><p><strong>æµ‹è¯•ï¼šåˆ©ç”¨JOLå·¥å…·è·Ÿè¸ªé”æ ‡è®°å˜åŒ–</strong></p><p><strong>åå‘é”</strong></p><p>åå‘é”æ˜¯ä¸€ç§é’ˆå¯¹åŠ é”æ“ä½œçš„ä¼˜åŒ–æ‰‹æ®µï¼Œç»è¿‡ç ”ç©¶å‘ç°ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œå› æ­¤ä¸ºäº†æ¶ˆé™¤æ•°æ®åœ¨æ— ç«äº‰æƒ…å†µä¸‹é”é‡å…¥ï¼ˆCASæ“ä½œï¼‰çš„å¼€é”€è€Œå¼•å…¥åå‘é”ã€‚å¯¹äºæ²¡æœ‰é”ç«äº‰çš„åœºåˆï¼Œåå‘é”æœ‰å¾ˆå¥½çš„ä¼˜åŒ–æ•ˆæœã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/***StringBufferå†…éƒ¨åŒæ­¥***/</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
   <span class="token keyword">return</span> count<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//System.out.println æ— æ„è¯†çš„ä½¿ç”¨é” </span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">newLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“JVMå¯ç”¨äº†åå‘é”æ¨¡å¼ï¼ˆjdk6é»˜è®¤å¼€å¯ï¼‰ï¼Œæ–°åˆ›å»ºå¯¹è±¡çš„Mark Wordä¸­çš„Thread Idä¸º0ï¼Œè¯´æ˜æ­¤æ—¶å¤„äº<strong>å¯åå‘ä½†æœªåå‘ä»»ä½•çº¿ç¨‹</strong>ï¼Œä¹Ÿå«åš<strong>åŒ¿ååå‘çŠ¶æ€</strong>(anonymously biased)ã€‚</p><p><strong>åå‘é”å»¶è¿Ÿåå‘</strong></p><p>**åå‘é”æ¨¡å¼å­˜åœ¨åå‘é”å»¶è¿Ÿæœºåˆ¶ï¼š**HotSpot è™šæ‹Ÿæœºåœ¨å¯åŠ¨åæœ‰ä¸ª 4s çš„å»¶è¿Ÿæ‰ä¼šå¯¹æ¯ä¸ªæ–°å»ºçš„å¯¹è±¡å¼€å¯åå‘é”æ¨¡å¼ã€‚JVMå¯åŠ¨æ—¶ä¼šè¿›è¡Œä¸€ç³»åˆ—çš„å¤æ‚æ´»åŠ¨ï¼Œæ¯”å¦‚è£…è½½é…ç½®ï¼Œç³»ç»Ÿç±»åˆå§‹åŒ–ç­‰ç­‰ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šä½¿ç”¨å¤§é‡synchronizedå…³é”®å­—å¯¹å¯¹è±¡åŠ é”ï¼Œä¸”è¿™äº›é”å¤§å¤šæ•°éƒ½ä¸æ˜¯åå‘é”ã€‚ä¸ºäº†å‡å°‘åˆå§‹åŒ–æ—¶é—´ï¼ŒJVMé»˜è®¤å»¶æ—¶åŠ è½½åå‘é”ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//å…³é—­å»¶è¿Ÿå¼€å¯åå‘é”</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">BiasedLockingStartupDelay</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">//ç¦æ­¢åå‘é”</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">-</span><span class="token class-name">UseBiasedLocking</span> 
<span class="token comment">//å¯ç”¨åå‘é”           </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éªŒè¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockEscalationDemo</span><span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>          
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4sååå‘é”ä¸ºå¯åå‘æˆ–è€…åŒ¿ååå‘çŠ¶æ€ï¼š</p><figure><img src="https://img.jssjqd.cn/202211221320642.png" alt="image-20221122132008719" tabindex="0" loading="lazy"><figcaption>image-20221122132008719</figcaption></figure><p>æ€è€ƒï¼šå¦‚æœé”LockEscalationDemo.classä¼šæ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Ÿ</p><p><strong>åå‘é”çŠ¶æ€è·Ÿè¸ª</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockEscalationDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//HotSpot è™šæ‹Ÿæœºåœ¨å¯åŠ¨åæœ‰ä¸ª 4s çš„å»¶è¿Ÿæ‰ä¼šå¯¹æ¯ä¸ªæ–°å»ºçš„å¯¹è±¡å¼€å¯åå‘é”æ¨¡å¼</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;è·å–é”æ‰§è¡Œä¸­ã€‚ã€‚ã€‚\n&quot;</span>
                            <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;é‡Šæ”¾é”ã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>       
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://img.jssjqd.cn/202211221320316.png" alt="image-20221122132040360" tabindex="0" loading="lazy"><figcaption>image-20221122132040360</figcaption></figure><p>æ€è€ƒï¼šå¦‚æœå¯¹è±¡è°ƒç”¨äº†hashCode,è¿˜ä¼šå¼€å¯åå‘é”æ¨¡å¼å—ï¼Ÿ</p><figure><img src="https://img.jssjqd.cn/202211221320126.png" alt="image-20221122132049618" tabindex="0" loading="lazy"><figcaption>image-20221122132049618</figcaption></figure><p><strong>åå‘é”æ’¤é”€ä¹‹è°ƒç”¨å¯¹è±¡HashCode</strong></p><p>è°ƒç”¨é”å¯¹è±¡çš„obj.hashCode()æˆ–System.identityHashCode(obj)æ–¹æ³•ä¼šå¯¼è‡´è¯¥å¯¹è±¡çš„åå‘é”è¢«æ’¤é”€ã€‚å› ä¸ºå¯¹äºä¸€ä¸ªå¯¹è±¡ï¼Œå…¶HashCodeåªä¼šç”Ÿæˆä¸€æ¬¡å¹¶ä¿å­˜ï¼Œåå‘é”æ˜¯æ²¡æœ‰åœ°æ–¹ä¿å­˜hashcodeçš„ã€‚</p><ul><li>è½»é‡çº§é”ä¼šåœ¨é”è®°å½•ä¸­è®°å½• hashCode</li><li>é‡é‡çº§é”ä¼šåœ¨ Monitor ä¸­è®°å½• hashCode</li></ul><p>å½“å¯¹è±¡å¤„äºå¯åå‘ï¼ˆä¹Ÿå°±æ˜¯çº¿ç¨‹IDä¸º0ï¼‰å’Œå·²åå‘çš„çŠ¶æ€ä¸‹ï¼Œè°ƒç”¨HashCodeè®¡ç®—å°†ä¼šä½¿å¯¹è±¡å†ä¹Ÿæ— æ³•åå‘ï¼š</p><ul><li>å½“å¯¹è±¡å¯åå‘æ—¶ï¼ŒMarkWordå°†å˜æˆæœªé”å®šçŠ¶æ€ï¼Œå¹¶åªèƒ½å‡çº§æˆè½»é‡é”ï¼›</li><li>å½“å¯¹è±¡æ­£å¤„äºåå‘é”æ—¶ï¼Œè°ƒç”¨HashCodeå°†ä½¿åå‘é”å¼ºåˆ¶å‡çº§æˆé‡é‡é”ã€‚ <img src="https://img.jssjqd.cn/202211221321099.png" alt="image-20221122132117976" loading="lazy"></li></ul><p><strong>åå‘é”æ’¤é”€ä¹‹è°ƒç”¨wait/notify</strong></p><p>åå‘é”çŠ¶æ€æ‰§è¡Œobj.notify() ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œè°ƒç”¨obj.wait(timeout) ä¼šå‡çº§ä¸ºé‡é‡çº§é”</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ€è€ƒï¼šåå‘é”æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨hashcodeä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span>
    <span class="token comment">//obj.hashCode();</span>
    <span class="token comment">//obj.notify();</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;è·å–é”æ‰§è¡Œä¸­ã€‚ã€‚ã€‚\n&quot;</span>
            <span class="token operator">+</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ç»“æœï¼š</p><p>â€‹ <img src="https://img.jssjqd.cn/202211221321494.png" alt="image-20221122132157289" loading="lazy"></p><p>â€‹ <img src="https://img.jssjqd.cn/202211221322649.png" alt="image-20221122132202423" loading="lazy"></p><p><strong>è½»é‡çº§é”</strong></p><p>å€˜è‹¥åå‘é”å¤±è´¥ï¼Œè™šæ‹Ÿæœºå¹¶ä¸ä¼šç«‹å³å‡çº§ä¸ºé‡é‡çº§é”ï¼Œå®ƒè¿˜ä¼šå°è¯•ä½¿ç”¨ä¸€ç§ç§°ä¸ºè½»é‡çº§é”çš„ä¼˜åŒ–æ‰‹æ®µï¼Œæ­¤æ—¶Mark Word çš„ç»“æ„ä¹Ÿå˜ä¸ºè½»é‡çº§é”çš„ç»“æ„ã€‚è½»é‡çº§é”æ‰€é€‚åº”çš„åœºæ™¯æ˜¯çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„åœºåˆï¼Œå¦‚æœå­˜åœ¨åŒä¸€æ—¶é—´å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€æŠŠé”çš„åœºåˆï¼Œå°±ä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p><p><strong>è½»é‡çº§é”è·Ÿè¸ª</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockEscalationDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//HotSpot è™šæ‹Ÿæœºåœ¨å¯åŠ¨åæœ‰ä¸ª 4s çš„å»¶è¿Ÿæ‰ä¼šå¯¹æ¯ä¸ªæ–°å»ºçš„å¯¹è±¡å¼€å¯åå‘é”æ¨¡å¼</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ€è€ƒï¼š å¦‚æœå¯¹è±¡è°ƒç”¨äº†hashCode,è¿˜ä¼šå¼€å¯åå‘é”æ¨¡å¼å—</span>
        obj<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">//log.debug(ClassLayout.parseInstance(obj).toPrintable());</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;è·å–é”æ‰§è¡Œä¸­ã€‚ã€‚ã€‚\n&quot;</span>
                            <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;é‡Šæ”¾é”ã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>            
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ€è€ƒï¼š è½»é‡çº§é”æ˜¯å¦å¯ä»¥é™çº§ä¸ºåå‘é”ï¼Ÿ</strong></p><p><em>é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§,æ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é”ã€‚</em></p><p><strong>æµ‹è¯•ï¼šé”å‡çº§åœºæ™¯</strong></p><p><strong>åå‘é”å‡çº§è½»é‡çº§é”</strong></p><p>æ¨¡æ‹Ÿä¸¤ä¸ªçº¿ç¨‹è½»å¾®ç«äº‰åœºæ™¯</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockEscalationDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//HotSpot è™šæ‹Ÿæœºåœ¨å¯åŠ¨åæœ‰ä¸ª 4s çš„å»¶è¿Ÿæ‰ä¼šå¯¹æ¯ä¸ªæ–°å»ºçš„å¯¹è±¡å¼€å¯åå‘é”æ¨¡å¼</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ€è€ƒï¼š å¦‚æœå¯¹è±¡è°ƒç”¨äº†hashCode,è¿˜ä¼šå¼€å¯åå‘é”æ¨¡å¼å—</span>
        <span class="token comment">//obj.hashCode();</span>
        <span class="token comment">//log.debug(ClassLayout.parseInstance(obj).toPrintable());</span>

        <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;å¼€å§‹æ‰§è¡Œã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// æ€è€ƒï¼šåå‘é”æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨hashcodeä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</span>
                    <span class="token comment">//obj.hashCode();</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;è·å–é”æ‰§è¡Œä¸­ã€‚ã€‚ã€‚\n&quot;</span>
                            <span class="token operator">+</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;é‡Šæ”¾é”ã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//æ§åˆ¶çº¿ç¨‹ç«äº‰æ—¶æœº</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> thread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;è·å–é”æ‰§è¡Œä¸­ã€‚ã€‚ã€‚\n&quot;</span>
                            <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;é‡Šæ”¾é”ã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;thread2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ <img src="https://img.jssjqd.cn/202211221330727.png" alt="image-20221122133016987" loading="lazy"></p><p><strong>è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockEscalationDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//HotSpot è™šæ‹Ÿæœºåœ¨å¯åŠ¨åæœ‰ä¸ª 4s çš„å»¶è¿Ÿæ‰ä¼šå¯¹æ¯ä¸ªæ–°å»ºçš„å¯¹è±¡å¼€å¯åå‘é”æ¨¡å¼</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;è·å–é”æ‰§è¡Œä¸­ã€‚ã€‚ã€‚\n&quot;</span>
                            <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;é‡Šæ”¾é”ã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;å¼€å§‹æ‰§è¡Œã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;è·å–é”æ‰§è¡Œä¸­ã€‚ã€‚ã€‚\n&quot;</span>
                            <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;é‡Šæ”¾é”ã€‚ã€‚ã€‚\n&quot;</span>
                        <span class="token operator">+</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;thread2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ <img src="https://img.jssjqd.cn/202211221330969.png" alt="image-20221122133052025" loading="lazy"></p><p><strong>æ€è€ƒï¼šé‡é‡çº§é”é‡Šæ”¾ä¹‹åå˜ä¸ºæ— é”ï¼Œæ­¤æ—¶æœ‰æ–°çš„çº¿ç¨‹æ¥è°ƒç”¨åŒæ­¥å—ï¼Œä¼šè·å–ä»€ä¹ˆé”ï¼Ÿ</strong></p><p>è½»é‡çº§é”</p><p><strong>æ€»ç»“ï¼šé”å¯¹è±¡çŠ¶æ€è½¬æ¢</strong></p><p>â€‹ <img src="https://img.jssjqd.cn/202211221330970.png" alt="image-20221122133058608" loading="lazy"></p><img src="https://img.jssjqd.cn/202211242201343.png" alt="image-20221124220139005"><p><strong>é”å‡çº§çš„åŸç†åˆ†æ</strong></p><p>ä¼šç»“åˆHotspotæºç é‡ç‚¹åˆ†æ</p><h2 id="synchronizedé”ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#synchronizedé”ä¼˜åŒ–" aria-hidden="true">#</a> synchronizedé”ä¼˜åŒ–</h2><h3 id="åå‘é”æ‰¹é‡é‡åå‘-æ‰¹é‡æ’¤é”€" tabindex="-1"><a class="header-anchor" href="#åå‘é”æ‰¹é‡é‡åå‘-æ‰¹é‡æ’¤é”€" aria-hidden="true">#</a> åå‘é”æ‰¹é‡é‡åå‘&amp;æ‰¹é‡æ’¤é”€</h3><p>ä»åå‘é”çš„åŠ é”è§£é”è¿‡ç¨‹ä¸­å¯çœ‹å‡ºï¼Œå½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹åå¤è¿›å…¥åŒæ­¥å—æ—¶ï¼Œåå‘é”å¸¦æ¥çš„æ€§èƒ½å¼€é”€åŸºæœ¬å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å½“æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å¾—é”æ—¶ï¼Œå°±éœ€è¦ç­‰åˆ°safe pointæ—¶ï¼Œå†å°†åå‘é”æ’¤é”€ä¸ºæ— é”çŠ¶æ€æˆ–å‡çº§ä¸ºè½»é‡çº§ï¼Œä¼šæ¶ˆè€—ä¸€å®šçš„æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç«äº‰é¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œåå‘é”ä¸ä»…ä¸èƒ½æé«˜æ€§èƒ½ï¼Œè¿˜ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚äºæ˜¯ï¼Œå°±æœ‰äº†æ‰¹é‡é‡åå‘ä¸æ‰¹é‡æ’¤é”€çš„æœºåˆ¶ã€‚</p><p><strong>åŸç†</strong></p><p>ä»¥classä¸ºå•ä½ï¼Œä¸ºæ¯ä¸ªclassç»´æŠ¤ä¸€ä¸ªåå‘é”æ’¤é”€è®¡æ•°å™¨ï¼Œæ¯ä¸€æ¬¡è¯¥classçš„å¯¹è±¡å‘ç”Ÿåå‘æ’¤é”€æ“ä½œæ—¶ï¼Œè¯¥è®¡æ•°å™¨+1ï¼Œå½“è¿™ä¸ªå€¼è¾¾åˆ°é‡åå‘é˜ˆå€¼ï¼ˆé»˜è®¤20ï¼‰æ—¶ï¼ŒJVMå°±è®¤ä¸ºè¯¥classçš„åå‘é”æœ‰é—®é¢˜ï¼Œå› æ­¤ä¼šè¿›è¡Œæ‰¹é‡é‡åå‘ã€‚</p><p>æ¯ä¸ªclasså¯¹è±¡ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„epochå­—æ®µï¼Œæ¯ä¸ªå¤„äºåå‘é”çŠ¶æ€å¯¹è±¡çš„Mark Wordä¸­ä¹Ÿæœ‰è¯¥å­—æ®µï¼Œå…¶åˆå§‹å€¼ä¸ºåˆ›å»ºè¯¥å¯¹è±¡æ—¶classä¸­çš„epochçš„å€¼ã€‚æ¯æ¬¡å‘ç”Ÿæ‰¹é‡é‡åå‘æ—¶ï¼Œå°±å°†è¯¥å€¼+1ï¼ŒåŒæ—¶éå†JVMä¸­æ‰€æœ‰çº¿ç¨‹çš„æ ˆï¼Œæ‰¾åˆ°è¯¥classæ‰€æœ‰æ­£å¤„äºåŠ é”çŠ¶æ€çš„åå‘é”ï¼Œå°†å…¶epochå­—æ®µæ”¹ä¸ºæ–°å€¼ã€‚ä¸‹æ¬¡è·å¾—é”æ—¶ï¼Œå‘ç°å½“å‰å¯¹è±¡çš„epochå€¼å’Œclassçš„epochä¸ç›¸ç­‰ï¼Œé‚£å°±ç®—å½“å‰å·²ç»åå‘äº†å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œæ’¤é”€æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡CASæ“ä½œå°†å…¶Mark Wordçš„Thread Id æ”¹æˆå½“å‰çº¿ç¨‹Idã€‚</p><p>å½“è¾¾åˆ°é‡åå‘é˜ˆå€¼ï¼ˆé»˜è®¤20ï¼‰åï¼Œå‡è®¾è¯¥classè®¡æ•°å™¨ç»§ç»­å¢é•¿ï¼Œå½“å…¶è¾¾åˆ°æ‰¹é‡æ’¤é”€çš„é˜ˆå€¼åï¼ˆé»˜è®¤40ï¼‰ï¼ŒJVMå°±è®¤ä¸ºè¯¥classçš„ä½¿ç”¨åœºæ™¯å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œä¼šæ ‡è®°è¯¥classä¸ºä¸å¯åå‘ï¼Œä¹‹åï¼Œå¯¹äºè¯¥classçš„é”ï¼Œç›´æ¥èµ°è½»é‡çº§é”çš„é€»è¾‘ã€‚</p><p><strong>åº”ç”¨åœºæ™¯</strong></p><p>æ‰¹é‡é‡åå‘ï¼ˆbulk rebiasï¼‰æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ï¼šä¸€ä¸ªçº¿ç¨‹åˆ›å»ºäº†å¤§é‡å¯¹è±¡å¹¶æ‰§è¡Œäº†åˆå§‹çš„åŒæ­¥æ“ä½œï¼Œåæ¥å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ¥å°†è¿™äº›å¯¹è±¡ä½œä¸ºé”å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„åå‘é”æ’¤é”€æ“ä½œã€‚</p><p>æ‰¹é‡æ’¤é”€ï¼ˆbulk revokeï¼‰æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ï¼šåœ¨æ˜æ˜¾å¤šçº¿ç¨‹ç«äº‰å‰§çƒˆçš„åœºæ™¯ä¸‹ä½¿ç”¨åå‘é”æ˜¯ä¸åˆé€‚çš„ã€‚</p><p><strong>JVMçš„é»˜è®¤å‚æ•°å€¼</strong></p><p>è®¾ç½®JVMå‚æ•°-XX:+PrintFlagsFinalï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å³å¯è¾“å‡ºJVMçš„é»˜è®¤å‚æ•°å€¼</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>intx BiasedLockingBulkRebiasThreshold  = 20  //é»˜è®¤åå‘é”æ‰¹é‡é‡åå‘é˜ˆå€¼              
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡-XX:BiasedLockingBulkRebiasThreshold å’Œ -XX:BiasedLockingBulkRevokeThreshold æ¥æ‰‹åŠ¨è®¾ç½®é˜ˆå€¼</p><p><strong>æµ‹è¯•ï¼šæ‰¹é‡é‡åå‘</strong></p><p>å½“æ’¤é”€åå‘é”é˜ˆå€¼è¶…è¿‡ 20 æ¬¡åï¼Œjvm ä¼šè¿™æ ·è§‰å¾—ï¼Œæˆ‘æ˜¯ä¸æ˜¯åå‘é”™äº†ï¼Œäºæ˜¯ä¼šåœ¨ç»™è¿™äº›å¯¹è±¡åŠ é”æ—¶é‡æ–°åå‘è‡³åŠ é”çº¿ç¨‹ï¼Œé‡åå‘ä¼šé‡ç½®å¯¹è±¡ çš„ Thread ID</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BiasedLockingTest</span> <span class="token punctuation">{</span>
    <span class="token comment">//å»¶æ—¶äº§ç”Ÿå¯åå‘å¯¹è±¡</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªlistï¼Œæ¥å­˜æ”¾é”å¯¹è±¡</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// çº¿ç¨‹1</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ–°å»ºé”å¯¹è±¡</span>
            <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//ä¸ºäº†é˜²æ­¢JVMçº¿ç¨‹å¤ç”¨ï¼Œåœ¨åˆ›å»ºå®Œå¯¹è±¡åï¼Œä¿æŒçº¿ç¨‹thead1çŠ¶æ€ä¸ºå­˜æ´»</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;thead1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//ç¡çœ 3sé’Ÿä¿è¯çº¿ç¨‹thead1åˆ›å»ºå¯¹è±¡å®Œæˆ</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰“å°thead1ï¼Œlistä¸­ç¬¬20ä¸ªå¯¹è±¡çš„å¯¹è±¡å¤´ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// çº¿ç¨‹2</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span> obj <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;=</span><span class="token number">15</span><span class="token operator">&amp;&amp;</span>i<span class="token operator">&lt;=</span><span class="token number">21</span><span class="token operator">||</span>i<span class="token operator">&gt;=</span><span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;thread2-ç¬¬&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ¬¡åŠ é”æ‰§è¡Œä¸­\t&quot;</span><span class="token operator">+</span>
                            <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">17</span><span class="token operator">||</span>i<span class="token operator">==</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;thread2-ç¬¬&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ¬¡é‡Šæ”¾é”\t&quot;</span><span class="token operator">+</span>
                        <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;thead2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ç»“æœï¼š</p><p>thread1: åˆ›å»º50ä¸ªåå‘çº¿ç¨‹thread1çš„åå‘é” 1-50 åå‘é” <img src="https://img.jssjqd.cn/202211221332518.png" alt="image-20221122133227388" loading="lazy"></p><p>thread2ï¼š</p><p>1-18 åå‘é”æ’¤é”€ï¼Œå‡çº§ä¸ºè½»é‡çº§é” ï¼ˆthread1é‡Šæ”¾é”ä¹‹åä¸ºåå‘é”çŠ¶æ€ï¼‰</p><p>19-40 åå‘é”æ’¤é”€è¾¾åˆ°é˜ˆå€¼ï¼ˆ20ï¼‰ï¼Œæ‰§è¡Œäº†æ‰¹é‡é‡åå‘ ï¼ˆæµ‹è¯•ç»“æœåœ¨ç¬¬19å°±å¼€å§‹æ‰¹é‡é‡åå‘äº†ï¼‰ <img src="https://img.jssjqd.cn/202211221332632.png" alt="image-20221122133248165" loading="lazy"></p><p><strong>æµ‹è¯•ï¼šæ‰¹é‡æ’¤é”€</strong></p><p>å½“æ’¤é”€åå‘é”é˜ˆå€¼è¶…è¿‡ 40 æ¬¡åï¼Œjvm ä¼šè®¤ä¸ºä¸è¯¥åå‘ï¼Œäºæ˜¯æ•´ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šå˜ä¸ºä¸å¯åå‘çš„ï¼Œæ–°å»ºçš„å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯åå‘çš„ã€‚</p><p>æ³¨æ„ï¼š<strong>æ—¶é—´-XX:BiasedLockingDecayTime=25000msèŒƒå›´å†…æ²¡æœ‰è¾¾åˆ°40æ¬¡ï¼Œæ’¤é”€æ¬¡æ•°æ¸…ä¸º0ï¼Œé‡æ–°è®¡æ—¶</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BiasedLockingTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//å»¶æ—¶äº§ç”Ÿå¯åå‘å¯¹è±¡</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºä¸€ä¸ªlistï¼Œæ¥å­˜æ”¾é”å¯¹è±¡</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// çº¿ç¨‹1</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// æ–°å»ºé”å¯¹è±¡</span>
                <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//ä¸ºäº†é˜²æ­¢JVMçº¿ç¨‹å¤ç”¨ï¼Œåœ¨åˆ›å»ºå®Œå¯¹è±¡åï¼Œä¿æŒçº¿ç¨‹thead1çŠ¶æ€ä¸ºå­˜æ´»</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;thead1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ç¡çœ 3sé’Ÿä¿è¯çº¿ç¨‹thead1åˆ›å»ºå¯¹è±¡å®Œæˆ</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰“å°thead1ï¼Œlistä¸­ç¬¬20ä¸ªå¯¹è±¡çš„å¯¹è±¡å¤´ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// çº¿ç¨‹2</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> obj <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;=</span><span class="token number">15</span><span class="token operator">&amp;&amp;</span>i<span class="token operator">&lt;=</span><span class="token number">21</span><span class="token operator">||</span>i<span class="token operator">&gt;=</span><span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;thread2-ç¬¬&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ¬¡åŠ é”æ‰§è¡Œä¸­\t&quot;</span><span class="token operator">+</span>
                                <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">17</span><span class="token operator">||</span>i<span class="token operator">==</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;thread2-ç¬¬&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ¬¡é‡Šæ”¾é”\t&quot;</span><span class="token operator">+</span>
                            <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;thead2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Object</span> lock <span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;=</span><span class="token number">17</span><span class="token operator">&amp;&amp;</span>i<span class="token operator">&lt;=</span><span class="token number">21</span><span class="token operator">||</span>i<span class="token operator">&gt;=</span><span class="token number">35</span><span class="token operator">&amp;&amp;</span>i<span class="token operator">&lt;=</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;thread3-ç¬¬&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ¬¡å‡†å¤‡åŠ é”\t&quot;</span><span class="token operator">+</span>
                            <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">&gt;=</span><span class="token number">17</span><span class="token operator">&amp;&amp;</span>i<span class="token operator">&lt;=</span><span class="token number">21</span><span class="token operator">||</span>i<span class="token operator">&gt;=</span><span class="token number">35</span><span class="token operator">&amp;&amp;</span>i<span class="token operator">&lt;=</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;thread3-ç¬¬&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ¬¡åŠ é”æ‰§è¡Œä¸­\t&quot;</span><span class="token operator">+</span>
                                <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;thread3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æŸ¥çœ‹æ–°åˆ›å»ºçš„å¯¹è±¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµ‹è¯•ç»“æœï¼š</p><p>thread3ï¼š</p><p>1-18 ä»æ— é”çŠ¶æ€ç›´æ¥è·å–è½»é‡çº§é” ï¼ˆthread2é‡Šæ”¾é”ä¹‹åå˜ä¸ºæ— é”çŠ¶æ€ï¼‰ <img src="https://img.jssjqd.cn/202211221333513.png" alt="image-20221122133333482" loading="lazy"></p><p>19-40 åå‘é”æ’¤é”€ï¼Œå‡çº§ä¸ºè½»é‡çº§é” ï¼ˆthread2é‡Šæ”¾é”ä¹‹åä¸ºåå‘é”çŠ¶æ€ï¼‰ <img src="https://img.jssjqd.cn/202211221333311.png" alt="image-20221122133356892" loading="lazy"></p><p>41-50 è¾¾åˆ°åå‘é”æ’¤é”€çš„é˜ˆå€¼40ï¼Œæ‰¹é‡æ’¤é”€åå‘é”ï¼Œå‡çº§ä¸ºè½»é‡çº§é” ï¼ˆthread1é‡Šæ”¾é”ä¹‹åä¸ºåå‘é”çŠ¶æ€ï¼‰</p><figure><img src="https://img.jssjqd.cn/202211221334891.png" alt="image-20221122133410643" tabindex="0" loading="lazy"><figcaption>image-20221122133410643</figcaption></figure><p>æ–°åˆ›å»ºçš„å¯¹è±¡ï¼š æ— é”çŠ¶æ€ <img src="https://img.jssjqd.cn/202211221334044.png" alt="image-20221122133418891" loading="lazy"></p><p><strong>æ€»ç»“</strong></p><ol><li>æ‰¹é‡é‡åå‘å’Œæ‰¹é‡æ’¤é”€æ˜¯é’ˆå¯¹ç±»çš„ä¼˜åŒ–ï¼Œå’Œå¯¹è±¡æ— å…³ã€‚</li><li>åå‘é”é‡åå‘ä¸€æ¬¡ä¹‹åä¸å¯å†æ¬¡é‡åå‘ã€‚</li><li>å½“æŸä¸ªç±»å·²ç»è§¦å‘æ‰¹é‡æ’¤é”€æœºåˆ¶åï¼ŒJVMä¼šé»˜è®¤å½“å‰ç±»äº§ç”Ÿäº†ä¸¥é‡çš„é—®é¢˜ï¼Œå‰¥å¤ºäº†è¯¥ç±»çš„æ–°å®ä¾‹å¯¹è±¡ä½¿ç”¨åå‘é”çš„æƒåˆ©</li></ol><h3 id="è‡ªæ—‹ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#è‡ªæ—‹ä¼˜åŒ–" aria-hidden="true">#</a> è‡ªæ—‹ä¼˜åŒ–</h3><p>é‡é‡çº§é”ç«äº‰çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªæ—‹æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è‡ªæ—‹æˆåŠŸï¼ˆå³è¿™æ—¶å€™æŒé”çº¿ç¨‹å·²ç»é€€å‡ºäº†åŒæ­¥å—ï¼Œé‡Šæ”¾äº†é”ï¼‰ï¼Œè¿™æ—¶å½“å‰çº¿ç¨‹å°±å¯ä»¥é¿å…é˜»å¡ã€‚</p><ul><li>è‡ªæ—‹ä¼šå ç”¨ CPU æ—¶é—´ï¼Œå•æ ¸ CPU è‡ªæ—‹å°±æ˜¯æµªè´¹ï¼Œå¤šæ ¸ CPU è‡ªæ—‹æ‰èƒ½å‘æŒ¥ä¼˜åŠ¿ã€‚</li><li>åœ¨ Java 6 ä¹‹åè‡ªæ—‹æ˜¯è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚å¯¹è±¡åˆšåˆšçš„ä¸€æ¬¡è‡ªæ—‹æ“ä½œæˆåŠŸè¿‡ï¼Œé‚£ä¹ˆè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹æˆåŠŸçš„å¯èƒ½æ€§ä¼šé«˜ï¼Œå°±å¤šè‡ªæ—‹å‡ æ¬¡ï¼›åä¹‹ï¼Œå°±å°‘è‡ªæ—‹ç”šè‡³ä¸è‡ªæ—‹ï¼Œæ¯”è¾ƒæ™ºèƒ½ã€‚</li><li>Java 7 ä¹‹åä¸èƒ½æ§åˆ¶æ˜¯å¦å¼€å¯è‡ªæ—‹åŠŸèƒ½</li></ul><p>æ³¨æ„ï¼šè‡ªæ—‹çš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘çº¿ç¨‹æŒ‚èµ·çš„æ¬¡æ•°ï¼Œå°½é‡é¿å…ç›´æ¥æŒ‚èµ·çº¿ç¨‹ï¼ˆæŒ‚èµ·æ“ä½œæ¶‰åŠç³»ç»Ÿè°ƒç”¨ï¼Œå­˜åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢ï¼Œè¿™æ‰æ˜¯é‡é‡çº§é”æœ€å¤§çš„å¼€é”€ï¼‰</p><h3 id="é”ç²—åŒ–" tabindex="-1"><a class="header-anchor" href="#é”ç²—åŒ–" aria-hidden="true">#</a> é”ç²—åŒ–</h3><p>å‡è®¾ä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½ä¼šå¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”åŠè§£é”ï¼Œç”šè‡³åŠ é”æ“ä½œæ˜¯å‡ºç°åœ¨å¾ªç¯ä½“ä¸­çš„ï¼Œå³ä½¿æ²¡æœ‰å‡ºç°çº¿ç¨‹ç«äº‰ï¼Œé¢‘ç¹åœ°è¿›è¡Œäº’æ–¥åŒæ­¥æ“ä½œä¹Ÿä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æŸè€—ã€‚å¦‚æœJVMæ£€æµ‹åˆ°æœ‰ä¸€è¿ä¸²é›¶ç¢çš„æ“ä½œéƒ½æ˜¯å¯¹åŒä¸€å¯¹è±¡çš„åŠ é”ï¼Œå°†ä¼šæ‰©å¤§åŠ é”åŒæ­¥çš„èŒƒå›´ï¼ˆå³é”ç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">StringBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * é”ç²—åŒ–
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; bbb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot; ccc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç æ¯æ¬¡è°ƒç”¨ buffer.append æ–¹æ³•éƒ½éœ€è¦åŠ é”å’Œè§£é”ï¼Œå¦‚æœJVMæ£€æµ‹åˆ°æœ‰ä¸€è¿ä¸²çš„å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”å’Œè§£é”çš„æ“ä½œï¼Œå°±ä¼šå°†å…¶åˆå¹¶æˆä¸€æ¬¡èŒƒå›´æ›´å¤§çš„åŠ é”å’Œè§£é”æ“ä½œï¼Œå³åœ¨ç¬¬ä¸€æ¬¡appendæ–¹æ³•æ—¶è¿›è¡ŒåŠ é”ï¼Œæœ€åä¸€æ¬¡appendæ–¹æ³•ç»“æŸåè¿›è¡Œè§£é”ã€‚</p><h3 id="é”æ¶ˆé™¤" tabindex="-1"><a class="header-anchor" href="#é”æ¶ˆé™¤" aria-hidden="true">#</a> é”æ¶ˆé™¤</h3><p>é”æ¶ˆé™¤å³åˆ é™¤ä¸å¿…è¦çš„åŠ é”æ“ä½œã€‚é”æ¶ˆé™¤æ˜¯Javaè™šæ‹Ÿæœºåœ¨JITç¼–è¯‘æœŸé—´ï¼Œé€šè¿‡å¯¹è¿è¡Œä¸Šä¸‹æ–‡çš„æ‰«æï¼Œå»é™¤ä¸å¯èƒ½å­˜åœ¨å…±äº«èµ„æºç«äº‰çš„é”ï¼Œé€šè¿‡é”æ¶ˆé™¤ï¼Œå¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”æ—¶é—´ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockEliminationTest</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * é”æ¶ˆé™¤
     * -XX:+EliminateLocks å¼€å¯é”æ¶ˆé™¤(jdk8é»˜è®¤å¼€å¯ï¼‰
     * -XX:-EliminateLocks å…³é—­é”æ¶ˆé™¤
     * <span class="token keyword">@param</span> <span class="token parameter">str1</span>
     * <span class="token keyword">@param</span> <span class="token parameter">str2</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span> str1<span class="token punctuation">,</span> <span class="token class-name">String</span> str2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuffer</span> stringBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stringBuffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">LockEliminationTest</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockEliminationTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            demo<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bbb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œæ—¶é—´ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>StringBufferçš„appendæ˜¯ä¸ªåŒæ­¥æ–¹æ³•ï¼Œä½†æ˜¯appendæ–¹æ³•ä¸­çš„ StringBuffer å±äºä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œä¸å¯èƒ½ä»è¯¥æ–¹æ³•ä¸­é€ƒé€¸å‡ºå»ï¼Œå› æ­¤å…¶å®è¿™è¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥å°†é”æ¶ˆé™¤ã€‚</p><p>æµ‹è¯•ç»“æœï¼š å…³é—­é”æ¶ˆé™¤æ‰§è¡Œæ—¶é—´4688 ms å¼€å¯é”æ¶ˆé™¤æ‰§è¡Œæ—¶é—´ï¼š2601 ms</p><h4 id="é€ƒé€¸åˆ†æ-escape-analysis" tabindex="-1"><a class="header-anchor" href="#é€ƒé€¸åˆ†æ-escape-analysis" aria-hidden="true">#</a> é€ƒé€¸åˆ†æ(Escape Analysisï¼‰</h4><p>é€ƒé€¸åˆ†æï¼Œæ˜¯ä¸€ç§å¯ä»¥æœ‰æ•ˆå‡å°‘Java ç¨‹åºä¸­åŒæ­¥è´Ÿè½½å’Œå†…å­˜å †åˆ†é…å‹åŠ›çš„è·¨å‡½æ•°å…¨å±€æ•°æ®æµåˆ†æç®—æ³•ã€‚é€šè¿‡é€ƒé€¸åˆ†æï¼ŒJava Hotspotç¼–è¯‘å™¨èƒ½å¤Ÿåˆ†æå‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡çš„å¼•ç”¨çš„ä½¿ç”¨èŒƒå›´ä»è€Œå†³å®šæ˜¯å¦è¦å°†è¿™ä¸ªå¯¹è±¡åˆ†é…åˆ°å †ä¸Šã€‚é€ƒé€¸åˆ†æçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸã€‚</p><p><strong>æ–¹æ³•é€ƒé€¸(å¯¹è±¡é€ƒå‡ºå½“å‰æ–¹æ³•)</strong></p><p>å½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä¹‰åï¼Œå®ƒå¯èƒ½è¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–åœ°æ–¹ä¸­ã€‚</p><p><strong>çº¿ç¨‹é€ƒé€¸((å¯¹è±¡é€ƒå‡ºå½“å‰çº¿ç¨‹)</strong></p><p>è¿™ä¸ªå¯¹è±¡ç”šè‡³å¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹è®¿é—®åˆ°ï¼Œä¾‹å¦‚èµ‹å€¼ç»™ç±»å˜é‡æˆ–å¯ä»¥åœ¨å…¶å®ƒçº¿ç¨‹ä¸­è®¿é—®çš„å®ä¾‹å˜é‡ã€‚</p><p><strong>ä½¿ç”¨é€ƒé€¸åˆ†æï¼Œç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç åšå¦‚ä¸‹ä¼˜åŒ–ï¼š</strong></p><p>1.åŒæ­¥çœç•¥æˆ–é”æ¶ˆé™¤(Synchronization Elimination)ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å‘ç°åªèƒ½ä»ä¸€ä¸ªçº¿ç¨‹è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªå¯¹è±¡çš„æ“ä½œå¯ä»¥ä¸è€ƒè™‘åŒæ­¥ã€‚</p><p>2.å°†å †åˆ†é…è½¬åŒ–ä¸ºæ ˆåˆ†é…(Stack Allocation)ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨å­ç¨‹åºä¸­è¢«åˆ†é…ï¼Œè¦ä½¿æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆæ°¸è¿œä¸ä¼šé€ƒé€¸ï¼Œå¯¹è±¡å¯èƒ½æ˜¯æ ˆåˆ†é…çš„å€™é€‰ï¼Œè€Œä¸æ˜¯å †åˆ†é…ã€‚</p><p>3.åˆ†ç¦»å¯¹è±¡æˆ–æ ‡é‡æ›¿æ¢(Scalar Replacement)ã€‚æœ‰çš„å¯¹è±¡å¯èƒ½ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªè¿ç»­çš„å†…å­˜ç»“æ„å­˜åœ¨ä¹Ÿå¯ä»¥è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆå¯¹è±¡çš„éƒ¨åˆ†ï¼ˆæˆ–å…¨éƒ¨ï¼‰å¯ä»¥ä¸å­˜å‚¨åœ¨å†…å­˜ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨CPUå¯„å­˜å™¨ä¸­ã€‚</p><p>jdk6æ‰å¼€å§‹å¼•å…¥è¯¥æŠ€æœ¯ï¼Œjdk7å¼€å§‹é»˜è®¤å¼€å¯é€ƒé€¸åˆ†æã€‚åœ¨Javaä»£ç è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°æŒ‡å®šæ˜¯å¦å¼€å¯é€ƒé€¸åˆ†æï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">DoEscapeAnalysis</span>  <span class="token comment">//è¡¨ç¤ºå¼€å¯é€ƒé€¸åˆ†æ (jdk1.8é»˜è®¤å¼€å¯ï¼‰</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">-</span><span class="token class-name">DoEscapeAnalysis</span> <span class="token comment">//è¡¨ç¤ºå…³é—­é€ƒé€¸åˆ†æã€‚</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">EliminateAllocations</span>   <span class="token comment">//å¼€å¯æ ‡é‡æ›¿æ¢(é»˜è®¤æ‰“å¼€)         </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span>  Fox
 *
 * è¿›è¡Œä¸¤ç§æµ‹è¯•
 * å…³é—­é€ƒé€¸åˆ†æï¼ŒåŒæ—¶è°ƒå¤§å †ç©ºé—´ï¼Œé¿å…å †å†…GCçš„å‘ç”Ÿï¼Œå¦‚æœæœ‰GCä¿¡æ¯å°†ä¼šè¢«æ‰“å°å‡ºæ¥
 * VMè¿è¡Œå‚æ•°ï¼š-Xmx4G -Xms4G -XX:-DoEscapeAnalysis -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError
 *
 * å¼€å¯é€ƒé€¸åˆ†æ  jdk8é»˜è®¤å¼€å¯
 * VMè¿è¡Œå‚æ•°ï¼š-Xmx4G -Xms4G -XX:+DoEscapeAnalysis -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError
 *
 * æ‰§è¡Œmainæ–¹æ³•å
 * jps æŸ¥çœ‹è¿›ç¨‹
 * jmap -histo è¿›ç¨‹ID
 *
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EscapeTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">500000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œæ—¶é—´ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * JITç¼–è¯‘æ—¶ä¼šå¯¹ä»£ç è¿›è¡Œé€ƒé€¸åˆ†æ
     * å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡å­˜æ”¾åœ¨å †åŒºï¼Œæœ‰çš„ä¸€éƒ¨åˆ†å­˜åœ¨çº¿ç¨‹æ ˆç©ºé—´
     * Ponitæ²¡æœ‰é€ƒé€¸
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> point<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     *åŒæ­¥çœç•¥ï¼ˆé”æ¶ˆé™¤ï¼‰  JITç¼–è¯‘é˜¶æ®µä¼˜åŒ–ï¼ŒJITç»è¿‡é€ƒé€¸åˆ†æä¹‹åå‘ç°æ— çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå°±ä¼šåšé”æ¶ˆé™¤
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span> str1<span class="token punctuation">,</span> <span class="token class-name">String</span> str2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuffer</span> stringBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stringBuffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ ‡é‡æ›¿æ¢
     *
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;point.x=&quot;</span><span class="token operator">+</span>point<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;; point.y=&quot;</span><span class="token operator">+</span>point<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        int x=1;</span>
<span class="token comment">//        int y=2;</span>
<span class="token comment">//        System.out.println(&quot;point.x=&quot;+x+&quot;; point.y=&quot;+y);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> y<span class="token punctuation">;</span>           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æµ‹è¯•ç»“æœï¼šå¼€å¯é€ƒé€¸åˆ†æï¼Œéƒ¨åˆ†å¯¹è±¡ä¼šåœ¨æ ˆä¸Šåˆ†é…</strong> <img src="https://img.jssjqd.cn/202211221335683.png" alt="image-20221122133552451" loading="lazy"> <img src="https://img.jssjqd.cn/202211221336961.png" alt="image-20221122133559575" loading="lazy"></p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><!----><div class="copyright">Copyright Â© 2023 æ±Ÿ</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-c8395efa.js" defer></script>
  </body>
</html>
