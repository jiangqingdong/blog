<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.62" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/pages/6f27a7/"><meta property="og:site_name" content="å­¦ä¹ ç¬”è®°"><meta property="og:title" content="AQSä¹‹ReentrantReadWriteLockè¯¦è§£"><meta property="og:description" content="è¯»å†™é”ä»‹ç» ç°å®ä¸­æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼šå¯¹å…±äº«èµ„æºæœ‰è¯»å’Œå†™çš„æ“ä½œï¼Œä¸”å†™æ“ä½œæ²¡æœ‰è¯»æ“ä½œé‚£ä¹ˆé¢‘ç¹ï¼ˆè¯»å¤šå†™å°‘ï¼‰ã€‚åœ¨æ²¡æœ‰å†™æ“ä½œçš„æ—¶å€™ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ä¸€ä¸ªèµ„æºæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæ‰€ä»¥åº”è¯¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼ˆè¯»è¯»å¯ä»¥å¹¶å‘ï¼‰ï¼›ä½†æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³å»å†™è¿™äº›å…±äº«èµ„æºï¼Œå°±ä¸åº”è¯¥å…è®¸å…¶ä»–çº¿ç¨‹å¯¹è¯¥èµ„æºè¿›è¡Œè¯»å’Œå†™æ“ä½œäº†ï¼ˆè¯»å†™ï¼Œå†™è¯»ï¼Œå†™å†™äº’æ–¥ï¼‰ã€‚åœ¨è¯»å¤šäºå†™çš„æƒ…å†µä¸‹ï¼Œè¯»å†™é”èƒ½å¤Ÿæä¾›æ¯”æ’å®ƒé”æ›´å¥½çš„å¹¶å‘æ€§å’Œååé‡ã€‚ é’ˆå¯¹è¿™ç§åœºæ™¯ï¼ŒJAVAçš„å¹¶å‘åŒ…æä¾›äº†è¯»å†™é”ReentrantReadWriteLockï¼Œå®ƒå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€å¯¹ç›¸å…³çš„é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œç§°ä¸ºè¯»é”ï¼›ä¸€ä¸ªç”¨äºå†™å…¥æ“ä½œï¼Œç§°ä¸ºå†™é”ï¼Œæè¿°å¦‚ä¸‹ï¼š"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-08-01T18:24:48.000Z"><meta property="article:author" content="æ±Ÿ"><meta property="article:published_time" content="2022-11-29T01:18:44.000Z"><meta property="article:modified_time" content="2023-08-01T18:24:48.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"AQSä¹‹ReentrantReadWriteLockè¯¦è§£","image":[""],"datePublished":"2022-11-29T01:18:44.000Z","dateModified":"2023-08-01T18:24:48.000Z","author":[{"@type":"Person","name":"æ±Ÿ"}]}</script><title>AQSä¹‹ReentrantReadWriteLockè¯¦è§£ | å­¦ä¹ ç¬”è®°</title><meta name="description" content="è¯»å†™é”ä»‹ç» ç°å®ä¸­æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼šå¯¹å…±äº«èµ„æºæœ‰è¯»å’Œå†™çš„æ“ä½œï¼Œä¸”å†™æ“ä½œæ²¡æœ‰è¯»æ“ä½œé‚£ä¹ˆé¢‘ç¹ï¼ˆè¯»å¤šå†™å°‘ï¼‰ã€‚åœ¨æ²¡æœ‰å†™æ“ä½œçš„æ—¶å€™ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ä¸€ä¸ªèµ„æºæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæ‰€ä»¥åº”è¯¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼ˆè¯»è¯»å¯ä»¥å¹¶å‘ï¼‰ï¼›ä½†æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³å»å†™è¿™äº›å…±äº«èµ„æºï¼Œå°±ä¸åº”è¯¥å…è®¸å…¶ä»–çº¿ç¨‹å¯¹è¯¥èµ„æºè¿›è¡Œè¯»å’Œå†™æ“ä½œäº†ï¼ˆè¯»å†™ï¼Œå†™è¯»ï¼Œå†™å†™äº’æ–¥ï¼‰ã€‚åœ¨è¯»å¤šäºå†™çš„æƒ…å†µä¸‹ï¼Œè¯»å†™é”èƒ½å¤Ÿæä¾›æ¯”æ’å®ƒé”æ›´å¥½çš„å¹¶å‘æ€§å’Œååé‡ã€‚ é’ˆå¯¹è¿™ç§åœºæ™¯ï¼ŒJAVAçš„å¹¶å‘åŒ…æä¾›äº†è¯»å†™é”ReentrantReadWriteLockï¼Œå®ƒå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€å¯¹ç›¸å…³çš„é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œç§°ä¸ºè¯»é”ï¼›ä¸€ä¸ªç”¨äºå†™å…¥æ“ä½œï¼Œç§°ä¸ºå†™é”ï¼Œæè¿°å¦‚ä¸‹ï¼š">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-d225b157.css" as="style"><link rel="stylesheet" href="/assets/style-d225b157.css">
    <link rel="modulepreload" href="/assets/app-21ce620e.js"><link rel="modulepreload" href="/assets/index.html-47cee948.js"><link rel="modulepreload" href="/assets/index.html-13e05219.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/intro.html-d050d194.js" as="script"><link rel="prefetch" href="/assets/index.html-3841b971.js" as="script"><link rel="prefetch" href="/assets/slides.html-4bcf9c90.js" as="script"><link rel="prefetch" href="/assets/index.html-9da1f986.js" as="script"><link rel="prefetch" href="/assets/index.html-06aa5afc.js" as="script"><link rel="prefetch" href="/assets/index.html-3cde2e9d.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-e29efed5.js" as="script"><link rel="prefetch" href="/assets/index.html-056a7c7b.js" as="script"><link rel="prefetch" href="/assets/index.html-196aee9a.js" as="script"><link rel="prefetch" href="/assets/index.html-15356fd6.js" as="script"><link rel="prefetch" href="/assets/index.html-b2ea937f.js" as="script"><link rel="prefetch" href="/assets/index.html-fae2cce2.js" as="script"><link rel="prefetch" href="/assets/index.html-3de3ac13.js" as="script"><link rel="prefetch" href="/assets/index.html-4fc833f7.js" as="script"><link rel="prefetch" href="/assets/index.html-a9380d59.js" as="script"><link rel="prefetch" href="/assets/index.html-0c227f79.js" as="script"><link rel="prefetch" href="/assets/index.html-ca9e9edd.js" as="script"><link rel="prefetch" href="/assets/index.html-3d73ef7f.js" as="script"><link rel="prefetch" href="/assets/index.html-eff3b4ec.js" as="script"><link rel="prefetch" href="/assets/index.html-63004bbb.js" as="script"><link rel="prefetch" href="/assets/index.html-b443c91f.js" as="script"><link rel="prefetch" href="/assets/index.html-eb7dc294.js" as="script"><link rel="prefetch" href="/assets/index.html-b3f10bbb.js" as="script"><link rel="prefetch" href="/assets/index.html-6036577c.js" as="script"><link rel="prefetch" href="/assets/index.html-58352f8e.js" as="script"><link rel="prefetch" href="/assets/index.html-1460385b.js" as="script"><link rel="prefetch" href="/assets/00.ç«™åœ¨å…¨å±€è§†è§’ç†è§£ç³»ç»Ÿé«˜å¹¶å‘.html-3a469a4c.js" as="script"><link rel="prefetch" href="/assets/index.html-1fffc64f.js" as="script"><link rel="prefetch" href="/assets/10.BIO NIOç¼–ç¨‹ä¸ç›´æ¥å†…å­˜é›¶æ‹·è´.html-0ab5e5cc.js" as="script"><link rel="prefetch" href="/assets/index.html-a1cae865.js" as="script"><link rel="prefetch" href="/assets/index.html-e045b02c.js" as="script"><link rel="prefetch" href="/assets/index.html-ab40fe3b.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-58f47ed2.js" as="script"><link rel="prefetch" href="/assets/index.html-78dacd72.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-d6647704.js" as="script"><link rel="prefetch" href="/assets/index.html-59afda48.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-d969e8ed.js" as="script"><link rel="prefetch" href="/assets/index.html-edca6dc4.js" as="script"><link rel="prefetch" href="/assets/index.html-1ae26749.js" as="script"><link rel="prefetch" href="/assets/index.html-f93219f2.js" as="script"><link rel="prefetch" href="/assets/index.html-31118532.js" as="script"><link rel="prefetch" href="/assets/å·¥å‚æ¨¡å¼.html-ad9410a3.js" as="script"><link rel="prefetch" href="/assets/å»ºé€ æ¨¡å¼.html-a04d73b9.js" as="script"><link rel="prefetch" href="/assets/index.html-c071222c.js" as="script"><link rel="prefetch" href="/assets/index.html-a4f315bf.js" as="script"><link rel="prefetch" href="/assets/index.html-b0022173.js" as="script"><link rel="prefetch" href="/assets/index.html-38e14dc8.js" as="script"><link rel="prefetch" href="/assets/index.html-cc3cc56c.js" as="script"><link rel="prefetch" href="/assets/index.html-fbcf9615.js" as="script"><link rel="prefetch" href="/assets/index.html-4cecd512.js" as="script"><link rel="prefetch" href="/assets/index.html-99ad6842.js" as="script"><link rel="prefetch" href="/assets/index.html-675c676e.js" as="script"><link rel="prefetch" href="/assets/index.html-2855e279.js" as="script"><link rel="prefetch" href="/assets/index.html-68bfa6a5.js" as="script"><link rel="prefetch" href="/assets/index.html-859c676b.js" as="script"><link rel="prefetch" href="/assets/index.html-fe205ef8.js" as="script"><link rel="prefetch" href="/assets/index.html-0cb20f1c.js" as="script"><link rel="prefetch" href="/assets/index.html-102cfae4.js" as="script"><link rel="prefetch" href="/assets/index.html-ae48c1df.js" as="script"><link rel="prefetch" href="/assets/index.html-814f7f1d.js" as="script"><link rel="prefetch" href="/assets/index.html-19779ea0.js" as="script"><link rel="prefetch" href="/assets/index.html-09cc3a43.js" as="script"><link rel="prefetch" href="/assets/index.html-cccbb13c.js" as="script"><link rel="prefetch" href="/assets/index.html-b8130103.js" as="script"><link rel="prefetch" href="/assets/index.html-1b4e8107.js" as="script"><link rel="prefetch" href="/assets/index.html-7045cf91.js" as="script"><link rel="prefetch" href="/assets/index.html-82e85232.js" as="script"><link rel="prefetch" href="/assets/index.html-46b70d01.js" as="script"><link rel="prefetch" href="/assets/index.html-a6c441fe.js" as="script"><link rel="prefetch" href="/assets/index.html-38736ecd.js" as="script"><link rel="prefetch" href="/assets/index.html-3d160279.js" as="script"><link rel="prefetch" href="/assets/index.html-70184545.js" as="script"><link rel="prefetch" href="/assets/index.html-0d7f9c84.js" as="script"><link rel="prefetch" href="/assets/index.html-50ec0628.js" as="script"><link rel="prefetch" href="/assets/index.html-6647c88b.js" as="script"><link rel="prefetch" href="/assets/index.html-e5fca210.js" as="script"><link rel="prefetch" href="/assets/index.html-4622c4d0.js" as="script"><link rel="prefetch" href="/assets/index.html-0aa16773.js" as="script"><link rel="prefetch" href="/assets/index.html-bcad5cb1.js" as="script"><link rel="prefetch" href="/assets/index.html-63434f2e.js" as="script"><link rel="prefetch" href="/assets/00.é«˜æ€§èƒ½MySQL-MySQLæ¶æ„.html-6d7f7e17.js" as="script"><link rel="prefetch" href="/assets/index.html-9c62895c.js" as="script"><link rel="prefetch" href="/assets/index.html-aa30bf04.js" as="script"><link rel="prefetch" href="/assets/index.html-18f91996.js" as="script"><link rel="prefetch" href="/assets/index.html-d4863e55.js" as="script"><link rel="prefetch" href="/assets/index.html-546eb3a2.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-0e42a487.js" as="script"><link rel="prefetch" href="/assets/index.html-53d3a5ee.js" as="script"><link rel="prefetch" href="/assets/index.html-2ee74260.js" as="script"><link rel="prefetch" href="/assets/index.html-1f029277.js" as="script"><link rel="prefetch" href="/assets/index.html-c20a9e23.js" as="script"><link rel="prefetch" href="/assets/index.html-af52d031.js" as="script"><link rel="prefetch" href="/assets/index.html-9308d7ca.js" as="script"><link rel="prefetch" href="/assets/20.å…³ç³»å‹æ•°æ®åº“å±‚é¢çš„é«˜å¹¶å‘ä¼˜åŒ–.html-610c7929.js" as="script"><link rel="prefetch" href="/assets/Sharding-JDBCåˆ†åº“åˆ†è¡¨åº”ç”¨å®æˆ˜.html-fe196458.js" as="script"><link rel="prefetch" href="/assets/index.html-645f2ddf.js" as="script"><link rel="prefetch" href="/assets/index.html-254985ce.js" as="script"><link rel="prefetch" href="/assets/index.html-a8a57423.js" as="script"><link rel="prefetch" href="/assets/index.html-60388c3a.js" as="script"><link rel="prefetch" href="/assets/index.html-159ca966.js" as="script"><link rel="prefetch" href="/assets/index.html-d1e1f170.js" as="script"><link rel="prefetch" href="/assets/10.ShardingJDBCåˆ†åº“åˆ†è¡¨å®æˆ˜æŒ‡å—.html-fbff4896.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-1d5254a6.js" as="script"><link rel="prefetch" href="/assets/index.html-8e0ddc23.js" as="script"><link rel="prefetch" href="/assets/index.html-ad1ece24.js" as="script"><link rel="prefetch" href="/assets/index.html-fb73493c.js" as="script"><link rel="prefetch" href="/assets/index.html-128d4b71.js" as="script"><link rel="prefetch" href="/assets/index.html-d9f15724.js" as="script"><link rel="prefetch" href="/assets/index.html-72ba2d35.js" as="script"><link rel="prefetch" href="/assets/index.html-951dfe3f.js" as="script"><link rel="prefetch" href="/assets/index.html-c6d45626.js" as="script"><link rel="prefetch" href="/assets/index.html-263f14aa.js" as="script"><link rel="prefetch" href="/assets/index.html-768ded15.js" as="script"><link rel="prefetch" href="/assets/index.html-25fcc8f6.js" as="script"><link rel="prefetch" href="/assets/index.html-f0d68cb4.js" as="script"><link rel="prefetch" href="/assets/index.html-fbc23d80.js" as="script"><link rel="prefetch" href="/assets/index.html-cd6512b5.js" as="script"><link rel="prefetch" href="/assets/index.html-0df55126.js" as="script"><link rel="prefetch" href="/assets/index.html-ee2ee741.js" as="script"><link rel="prefetch" href="/assets/index.html-0cefaac0.js" as="script"><link rel="prefetch" href="/assets/Seataäº‹åŠ¡æ¨¡å¼.html-c1a2d7b8.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-1dd75d49.js" as="script"><link rel="prefetch" href="/assets/index.html-e60f4990.js" as="script"><link rel="prefetch" href="/assets/index.html-775dacd4.js" as="script"><link rel="prefetch" href="/assets/index.html-d478e84e.js" as="script"><link rel="prefetch" href="/assets/index.html-2c89d1e5.js" as="script"><link rel="prefetch" href="/assets/index.html-22f6ba4c.js" as="script"><link rel="prefetch" href="/assets/index.html-8d73c7f5.js" as="script"><link rel="prefetch" href="/assets/index.html-1534c5b2.js" as="script"><link rel="prefetch" href="/assets/index.html-7c9f70b1.js" as="script"><link rel="prefetch" href="/assets/index.html-8129550b.js" as="script"><link rel="prefetch" href="/assets/index.html-e6f50774.js" as="script"><link rel="prefetch" href="/assets/index.html-881fba3f.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-eb0655fe.js" as="script"><link rel="prefetch" href="/assets/404.html-f4f9fdbe.js" as="script"><link rel="prefetch" href="/assets/index.html-ccedd87a.js" as="script"><link rel="prefetch" href="/assets/index.html-6b635626.js" as="script"><link rel="prefetch" href="/assets/index.html-0d639806.js" as="script"><link rel="prefetch" href="/assets/index.html-19b5aac4.js" as="script"><link rel="prefetch" href="/assets/index.html-f3c1ea90.js" as="script"><link rel="prefetch" href="/assets/index.html-e4505c26.js" as="script"><link rel="prefetch" href="/assets/index.html-c67c6358.js" as="script"><link rel="prefetch" href="/assets/index.html-08bdbe35.js" as="script"><link rel="prefetch" href="/assets/index.html-39a19522.js" as="script"><link rel="prefetch" href="/assets/index.html-4e6ecfce.js" as="script"><link rel="prefetch" href="/assets/index.html-c37db087.js" as="script"><link rel="prefetch" href="/assets/index.html-7f2f880b.js" as="script"><link rel="prefetch" href="/assets/index.html-f8546af5.js" as="script"><link rel="prefetch" href="/assets/index.html-36e6cb8c.js" as="script"><link rel="prefetch" href="/assets/index.html-27371869.js" as="script"><link rel="prefetch" href="/assets/index.html-4c15c6fc.js" as="script"><link rel="prefetch" href="/assets/index.html-116aca17.js" as="script"><link rel="prefetch" href="/assets/index.html-2a643c60.js" as="script"><link rel="prefetch" href="/assets/index.html-21236a9b.js" as="script"><link rel="prefetch" href="/assets/index.html-b238d9f4.js" as="script"><link rel="prefetch" href="/assets/index.html-46e55ee3.js" as="script"><link rel="prefetch" href="/assets/index.html-6d53c5d1.js" as="script"><link rel="prefetch" href="/assets/index.html-778d883e.js" as="script"><link rel="prefetch" href="/assets/index.html-d798a209.js" as="script"><link rel="prefetch" href="/assets/index.html-ab8b6fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-200c9b62.js" as="script"><link rel="prefetch" href="/assets/index.html-d67216d5.js" as="script"><link rel="prefetch" href="/assets/index.html-9fa57983.js" as="script"><link rel="prefetch" href="/assets/index.html-2a6dfb95.js" as="script"><link rel="prefetch" href="/assets/index.html-30ef2e2b.js" as="script"><link rel="prefetch" href="/assets/index.html-2be3f4a2.js" as="script"><link rel="prefetch" href="/assets/index.html-4b04c8af.js" as="script"><link rel="prefetch" href="/assets/index.html-f3f33451.js" as="script"><link rel="prefetch" href="/assets/index.html-940c35a3.js" as="script"><link rel="prefetch" href="/assets/index.html-3fd779a7.js" as="script"><link rel="prefetch" href="/assets/index.html-1a8f23e9.js" as="script"><link rel="prefetch" href="/assets/index.html-0118c6d9.js" as="script"><link rel="prefetch" href="/assets/index.html-942ff972.js" as="script"><link rel="prefetch" href="/assets/index.html-41b511cf.js" as="script"><link rel="prefetch" href="/assets/index.html-c93e5cd2.js" as="script"><link rel="prefetch" href="/assets/index.html-6508b456.js" as="script"><link rel="prefetch" href="/assets/index.html-ed0506a1.js" as="script"><link rel="prefetch" href="/assets/index.html-d92890df.js" as="script"><link rel="prefetch" href="/assets/index.html-b2b41008.js" as="script"><link rel="prefetch" href="/assets/index.html-ac4c44c1.js" as="script"><link rel="prefetch" href="/assets/index.html-0ef231d8.js" as="script"><link rel="prefetch" href="/assets/intro.html-e7428ff2.js" as="script"><link rel="prefetch" href="/assets/index.html-b9556fc8.js" as="script"><link rel="prefetch" href="/assets/slides.html-eab48236.js" as="script"><link rel="prefetch" href="/assets/index.html-665afd14.js" as="script"><link rel="prefetch" href="/assets/index.html-f83f9993.js" as="script"><link rel="prefetch" href="/assets/index.html-56978f7b.js" as="script"><link rel="prefetch" href="/assets/04-Springä¹‹Beanç”Ÿå‘½å‘¨æœŸæºç è§£æä¸Š.html-b7247965.js" as="script"><link rel="prefetch" href="/assets/index.html-8cc559be.js" as="script"><link rel="prefetch" href="/assets/index.html-a7dd8fd8.js" as="script"><link rel="prefetch" href="/assets/index.html-3a98d1c4.js" as="script"><link rel="prefetch" href="/assets/index.html-d73a1525.js" as="script"><link rel="prefetch" href="/assets/index.html-5318c4d7.js" as="script"><link rel="prefetch" href="/assets/index.html-457ce9e7.js" as="script"><link rel="prefetch" href="/assets/index.html-fdd8356b.js" as="script"><link rel="prefetch" href="/assets/index.html-e0d66afa.js" as="script"><link rel="prefetch" href="/assets/index.html-4e2bbab4.js" as="script"><link rel="prefetch" href="/assets/index.html-d910f15a.js" as="script"><link rel="prefetch" href="/assets/index.html-9561ff1d.js" as="script"><link rel="prefetch" href="/assets/index.html-30f80999.js" as="script"><link rel="prefetch" href="/assets/index.html-9dcbc31f.js" as="script"><link rel="prefetch" href="/assets/index.html-2aaba023.js" as="script"><link rel="prefetch" href="/assets/index.html-56beecf2.js" as="script"><link rel="prefetch" href="/assets/index.html-4ac77b65.js" as="script"><link rel="prefetch" href="/assets/index.html-04680db9.js" as="script"><link rel="prefetch" href="/assets/index.html-b84485e7.js" as="script"><link rel="prefetch" href="/assets/index.html-d555ed94.js" as="script"><link rel="prefetch" href="/assets/00.ç«™åœ¨å…¨å±€è§†è§’ç†è§£ç³»ç»Ÿé«˜å¹¶å‘.html-c582b4ed.js" as="script"><link rel="prefetch" href="/assets/index.html-117a8cc9.js" as="script"><link rel="prefetch" href="/assets/10.BIO NIOç¼–ç¨‹ä¸ç›´æ¥å†…å­˜é›¶æ‹·è´.html-dff5b870.js" as="script"><link rel="prefetch" href="/assets/index.html-419bc6bd.js" as="script"><link rel="prefetch" href="/assets/index.html-0e274601.js" as="script"><link rel="prefetch" href="/assets/index.html-ac9e6eb3.js" as="script"><link rel="prefetch" href="/assets/100.é«˜å¹¶å‘ç¼“å­˜å®æˆ˜.html-bb3dca4e.js" as="script"><link rel="prefetch" href="/assets/index.html-e8d1cd6b.js" as="script"><link rel="prefetch" href="/assets/30.å¾®æœåŠ¡æ¶æ„æ‹†åˆ†å®æˆ˜.html-464c7c8a.js" as="script"><link rel="prefetch" href="/assets/index.html-9eb9424d.js" as="script"><link rel="prefetch" href="/assets/50.å¾®æœåŠ¡ç½‘å…³æ•´åˆOAuth2.0æˆæƒä¸­å¿ƒ.html-65ba9822.js" as="script"><link rel="prefetch" href="/assets/index.html-45d4c581.js" as="script"><link rel="prefetch" href="/assets/index.html-b2cad19a.js" as="script"><link rel="prefetch" href="/assets/index.html-b445b218.js" as="script"><link rel="prefetch" href="/assets/index.html-38eb336b.js" as="script"><link rel="prefetch" href="/assets/å·¥å‚æ¨¡å¼.html-25c7fcbc.js" as="script"><link rel="prefetch" href="/assets/å»ºé€ æ¨¡å¼.html-6a394885.js" as="script"><link rel="prefetch" href="/assets/index.html-383d6ee9.js" as="script"><link rel="prefetch" href="/assets/index.html-438346eb.js" as="script"><link rel="prefetch" href="/assets/index.html-15195453.js" as="script"><link rel="prefetch" href="/assets/index.html-c658f99c.js" as="script"><link rel="prefetch" href="/assets/index.html-1f92e072.js" as="script"><link rel="prefetch" href="/assets/index.html-f8c6ac49.js" as="script"><link rel="prefetch" href="/assets/index.html-a3f43e72.js" as="script"><link rel="prefetch" href="/assets/index.html-3a254eea.js" as="script"><link rel="prefetch" href="/assets/index.html-c5c6650c.js" as="script"><link rel="prefetch" href="/assets/index.html-23f096ab.js" as="script"><link rel="prefetch" href="/assets/index.html-5ebaadcf.js" as="script"><link rel="prefetch" href="/assets/index.html-b2773566.js" as="script"><link rel="prefetch" href="/assets/index.html-6cbf478d.js" as="script"><link rel="prefetch" href="/assets/index.html-e831014e.js" as="script"><link rel="prefetch" href="/assets/index.html-785ed7bb.js" as="script"><link rel="prefetch" href="/assets/index.html-f3e74dfc.js" as="script"><link rel="prefetch" href="/assets/index.html-f81d62bb.js" as="script"><link rel="prefetch" href="/assets/index.html-8ad8341a.js" as="script"><link rel="prefetch" href="/assets/index.html-a79cad4a.js" as="script"><link rel="prefetch" href="/assets/index.html-47595303.js" as="script"><link rel="prefetch" href="/assets/index.html-b480d9bc.js" as="script"><link rel="prefetch" href="/assets/index.html-a92c053c.js" as="script"><link rel="prefetch" href="/assets/index.html-bfc04686.js" as="script"><link rel="prefetch" href="/assets/index.html-9d3fe728.js" as="script"><link rel="prefetch" href="/assets/index.html-47cf51fb.js" as="script"><link rel="prefetch" href="/assets/index.html-ac350db2.js" as="script"><link rel="prefetch" href="/assets/index.html-4c6cd4a4.js" as="script"><link rel="prefetch" href="/assets/index.html-911b3838.js" as="script"><link rel="prefetch" href="/assets/index.html-69be0725.js" as="script"><link rel="prefetch" href="/assets/index.html-23073987.js" as="script"><link rel="prefetch" href="/assets/index.html-bc49fd05.js" as="script"><link rel="prefetch" href="/assets/index.html-b96ee357.js" as="script"><link rel="prefetch" href="/assets/index.html-7a9bcddf.js" as="script"><link rel="prefetch" href="/assets/index.html-4a3838c4.js" as="script"><link rel="prefetch" href="/assets/index.html-a8d05a68.js" as="script"><link rel="prefetch" href="/assets/index.html-efbe38da.js" as="script"><link rel="prefetch" href="/assets/index.html-dc25f82d.js" as="script"><link rel="prefetch" href="/assets/00.é«˜æ€§èƒ½MySQL-MySQLæ¶æ„.html-7427ff15.js" as="script"><link rel="prefetch" href="/assets/index.html-ad6497af.js" as="script"><link rel="prefetch" href="/assets/index.html-e902ce98.js" as="script"><link rel="prefetch" href="/assets/index.html-d2b23147.js" as="script"><link rel="prefetch" href="/assets/index.html-83b4d8ba.js" as="script"><link rel="prefetch" href="/assets/index.html-a8530f1e.js" as="script"><link rel="prefetch" href="/assets/06.MySQLäº‹åŠ¡åŸç†ä¸ä¼˜åŒ–æœ€ä½³å®è·µ.html-adb3aaea.js" as="script"><link rel="prefetch" href="/assets/index.html-e9c9a57e.js" as="script"><link rel="prefetch" href="/assets/index.html-1a4efafa.js" as="script"><link rel="prefetch" href="/assets/index.html-586e29b9.js" as="script"><link rel="prefetch" href="/assets/index.html-d7b366a1.js" as="script"><link rel="prefetch" href="/assets/index.html-b8f399a3.js" as="script"><link rel="prefetch" href="/assets/index.html-c3bf8003.js" as="script"><link rel="prefetch" href="/assets/20.å…³ç³»å‹æ•°æ®åº“å±‚é¢çš„é«˜å¹¶å‘ä¼˜åŒ–.html-d4d5b2b5.js" as="script"><link rel="prefetch" href="/assets/Sharding-JDBCåˆ†åº“åˆ†è¡¨åº”ç”¨å®æˆ˜.html-21cd0604.js" as="script"><link rel="prefetch" href="/assets/index.html-77d9b9b3.js" as="script"><link rel="prefetch" href="/assets/index.html-1e755c68.js" as="script"><link rel="prefetch" href="/assets/index.html-cbf299b0.js" as="script"><link rel="prefetch" href="/assets/index.html-c00cf0ce.js" as="script"><link rel="prefetch" href="/assets/index.html-e66b6beb.js" as="script"><link rel="prefetch" href="/assets/index.html-df52a6c0.js" as="script"><link rel="prefetch" href="/assets/10.ShardingJDBCåˆ†åº“åˆ†è¡¨å®æˆ˜æŒ‡å—.html-31c4b2b5.js" as="script"><link rel="prefetch" href="/assets/20.ShardingJDBCæºç ä¸å†…æ ¸è§£æ.html-e7a27975.js" as="script"><link rel="prefetch" href="/assets/index.html-af76769c.js" as="script"><link rel="prefetch" href="/assets/index.html-707342c5.js" as="script"><link rel="prefetch" href="/assets/index.html-c3af8924.js" as="script"><link rel="prefetch" href="/assets/index.html-5a24cd56.js" as="script"><link rel="prefetch" href="/assets/index.html-f7fc1f1a.js" as="script"><link rel="prefetch" href="/assets/index.html-9175bdcf.js" as="script"><link rel="prefetch" href="/assets/index.html-51103a80.js" as="script"><link rel="prefetch" href="/assets/index.html-9829f24a.js" as="script"><link rel="prefetch" href="/assets/index.html-c2c7c44a.js" as="script"><link rel="prefetch" href="/assets/index.html-394e244d.js" as="script"><link rel="prefetch" href="/assets/index.html-7047881d.js" as="script"><link rel="prefetch" href="/assets/index.html-cba9b20c.js" as="script"><link rel="prefetch" href="/assets/index.html-99225007.js" as="script"><link rel="prefetch" href="/assets/index.html-29dc177e.js" as="script"><link rel="prefetch" href="/assets/index.html-a5e85ce7.js" as="script"><link rel="prefetch" href="/assets/index.html-abec4e92.js" as="script"><link rel="prefetch" href="/assets/index.html-68d56ed9.js" as="script"><link rel="prefetch" href="/assets/Seataäº‹åŠ¡æ¨¡å¼.html-df1eb2a0.js" as="script"><link rel="prefetch" href="/assets/åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶Seata.html-cdc2e793.js" as="script"><link rel="prefetch" href="/assets/index.html-1b562cc9.js" as="script"><link rel="prefetch" href="/assets/index.html-4fa6e20b.js" as="script"><link rel="prefetch" href="/assets/index.html-a522e76b.js" as="script"><link rel="prefetch" href="/assets/index.html-4decfe2a.js" as="script"><link rel="prefetch" href="/assets/index.html-c89e916d.js" as="script"><link rel="prefetch" href="/assets/index.html-aa43cae4.js" as="script"><link rel="prefetch" href="/assets/index.html-220b0632.js" as="script"><link rel="prefetch" href="/assets/index.html-32ecb0a8.js" as="script"><link rel="prefetch" href="/assets/index.html-15509799.js" as="script"><link rel="prefetch" href="/assets/index.html-8fe3446c.js" as="script"><link rel="prefetch" href="/assets/index.html-5ba307b5.js" as="script"><link rel="prefetch" href="/assets/02.RocketMQå¼€å‘æ¨¡å‹ä¸ç”Ÿäº§ç¯å¢ƒé—®é¢˜å‰–æ.html-f7418d44.js" as="script"><link rel="prefetch" href="/assets/404.html-23fe042b.js" as="script"><link rel="prefetch" href="/assets/index.html-bee8e10a.js" as="script"><link rel="prefetch" href="/assets/index.html-c6bddc61.js" as="script"><link rel="prefetch" href="/assets/index.html-69a53714.js" as="script"><link rel="prefetch" href="/assets/index.html-d3c81ef8.js" as="script"><link rel="prefetch" href="/assets/index.html-a652e14a.js" as="script"><link rel="prefetch" href="/assets/index.html-c4e39ae4.js" as="script"><link rel="prefetch" href="/assets/index.html-731c07f8.js" as="script"><link rel="prefetch" href="/assets/index.html-e3e9f7ac.js" as="script"><link rel="prefetch" href="/assets/index.html-0427bad4.js" as="script"><link rel="prefetch" href="/assets/index.html-e46d04b7.js" as="script"><link rel="prefetch" href="/assets/index.html-1a6f4236.js" as="script"><link rel="prefetch" href="/assets/index.html-6bf4332d.js" as="script"><link rel="prefetch" href="/assets/index.html-aae387cc.js" as="script"><link rel="prefetch" href="/assets/index.html-b76a362c.js" as="script"><link rel="prefetch" href="/assets/index.html-3854a209.js" as="script"><link rel="prefetch" href="/assets/index.html-96cf762e.js" as="script"><link rel="prefetch" href="/assets/index.html-4eb91ff5.js" as="script"><link rel="prefetch" href="/assets/index.html-5784bcd9.js" as="script"><link rel="prefetch" href="/assets/index.html-90ebbb17.js" as="script"><link rel="prefetch" href="/assets/index.html-f33a1fe5.js" as="script"><link rel="prefetch" href="/assets/index.html-d8e1124b.js" as="script"><link rel="prefetch" href="/assets/index.html-27e27972.js" as="script"><link rel="prefetch" href="/assets/index.html-5180dca2.js" as="script"><link rel="prefetch" href="/assets/index.html-3c161dff.js" as="script"><link rel="prefetch" href="/assets/index.html-3afcabaf.js" as="script"><link rel="prefetch" href="/assets/index.html-078dd1cb.js" as="script"><link rel="prefetch" href="/assets/index.html-cb063f71.js" as="script"><link rel="prefetch" href="/assets/index.html-7ea20f90.js" as="script"><link rel="prefetch" href="/assets/index.html-14a634b9.js" as="script"><link rel="prefetch" href="/assets/index.html-bc140489.js" as="script"><link rel="prefetch" href="/assets/index.html-c1718895.js" as="script"><link rel="prefetch" href="/assets/index.html-11d1f9e0.js" as="script"><link rel="prefetch" href="/assets/index.html-503c7ff1.js" as="script"><link rel="prefetch" href="/assets/index.html-0bff167b.js" as="script"><link rel="prefetch" href="/assets/index.html-3180bf73.js" as="script"><link rel="prefetch" href="/assets/index.html-547654c9.js" as="script"><link rel="prefetch" href="/assets/index.html-03c68b8c.js" as="script"><link rel="prefetch" href="/assets/index.html-2fbd4b34.js" as="script"><link rel="prefetch" href="/assets/index.html-aa3eb555.js" as="script"><link rel="prefetch" href="/assets/index.html-b1dc3146.js" as="script"><link rel="prefetch" href="/assets/index.html-3f92a9e4.js" as="script"><link rel="prefetch" href="/assets/index.html-db96decf.js" as="script"><link rel="prefetch" href="/assets/index.html-7c1c02d3.js" as="script"><link rel="prefetch" href="/assets/index.html-0ed8546c.js" as="script"><link rel="prefetch" href="/assets/index.html-f8450136.js" as="script"><link rel="prefetch" href="/assets/index.html-e37a870c.js" as="script"><link rel="prefetch" href="/assets/giscus-52604b1e.js" as="script"><link rel="prefetch" href="/assets/auto-fa8841cf.js" as="script"><link rel="prefetch" href="/assets/index-ae8c1e74.js" as="script"><link rel="prefetch" href="/assets/flowchart-d65a1d8e.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-326ca727.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-258a50e0.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-2450701e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="å­¦ä¹ ç¬”è®°"><!----><span class="site-name hide-in-pad">å­¦ä¹ ç¬”è®°</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><!----><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->AQSä¹‹ReentrantReadWriteLockè¯¦è§£</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">æ±Ÿ</span></span><span property="author" content="æ±Ÿ"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-11-29T01:18:44.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 12 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT12M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category6 clickable" role="navigation">å¹¶å‘ç¼–ç¨‹</span><!--]--><meta property="articleSection" content="å¹¶å‘ç¼–ç¨‹"></span><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#è¯»å†™é”ä»‹ç»" class="router-link-active router-link-exact-active toc-link level2">è¯»å†™é”ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#reentrantreadwritelockçš„ä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level2">ReentrantReadWriteLockçš„ä½¿ç”¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#è¯»å†™é”æ¥å£readwritelock" class="router-link-active router-link-exact-active toc-link level3">è¯»å†™é”æ¥å£ReadWriteLock</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#reentrantreadwritelockç±»ç»“æ„" class="router-link-active router-link-exact-active toc-link level3">ReentrantReadWriteLockç±»ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#åº”ç”¨åœºæ™¯" class="router-link-active router-link-exact-active toc-link level3">åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#é”é™çº§" class="router-link-active router-link-exact-active toc-link level3">é”é™çº§</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#reentrantreadwritelockæºç åˆ†æ" class="router-link-active router-link-exact-active toc-link level2">ReentrantReadWriteLockæºç åˆ†æ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#reentrantreadwritelockç»“æ„" class="router-link-active router-link-exact-active toc-link level3">ReentrantReadWriteLockç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#è¯»å†™çŠ¶æ€çš„è®¾è®¡" class="router-link-active router-link-exact-active toc-link level3">è¯»å†™çŠ¶æ€çš„è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#holdcounter-è®¡æ•°å™¨" class="router-link-active router-link-exact-active toc-link level3">HoldCounter è®¡æ•°å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#å†™é”çš„è·å–" class="router-link-active router-link-exact-active toc-link level3">å†™é”çš„è·å–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#å†™é”çš„é‡Šæ”¾" class="router-link-active router-link-exact-active toc-link level3">å†™é”çš„é‡Šæ”¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#è¯»é”çš„è·å–" class="router-link-active router-link-exact-active toc-link level3">è¯»é”çš„è·å–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/pages/6f27a7/#è¯»é”çš„é‡Šæ”¾" class="router-link-active router-link-exact-active toc-link level3">è¯»é”çš„é‡Šæ”¾</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="è¯»å†™é”ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#è¯»å†™é”ä»‹ç»" aria-hidden="true">#</a> è¯»å†™é”ä»‹ç»</h2><p>ç°å®ä¸­æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼šå¯¹å…±äº«èµ„æºæœ‰è¯»å’Œå†™çš„æ“ä½œï¼Œä¸”å†™æ“ä½œæ²¡æœ‰è¯»æ“ä½œé‚£ä¹ˆé¢‘ç¹ï¼ˆè¯»å¤šå†™å°‘ï¼‰ã€‚åœ¨æ²¡æœ‰å†™æ“ä½œçš„æ—¶å€™ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ä¸€ä¸ªèµ„æºæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæ‰€ä»¥åº”è¯¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼ˆè¯»è¯»å¯ä»¥å¹¶å‘ï¼‰ï¼›ä½†æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³å»å†™è¿™äº›å…±äº«èµ„æºï¼Œå°±ä¸åº”è¯¥å…è®¸å…¶ä»–çº¿ç¨‹å¯¹è¯¥èµ„æºè¿›è¡Œè¯»å’Œå†™æ“ä½œäº†ï¼ˆè¯»å†™ï¼Œå†™è¯»ï¼Œå†™å†™äº’æ–¥ï¼‰ã€‚åœ¨è¯»å¤šäºå†™çš„æƒ…å†µä¸‹ï¼Œè¯»å†™é”èƒ½å¤Ÿæä¾›æ¯”æ’å®ƒé”æ›´å¥½çš„å¹¶å‘æ€§å’Œååé‡ã€‚</p><p>é’ˆå¯¹è¿™ç§åœºæ™¯ï¼ŒJAVAçš„å¹¶å‘åŒ…æä¾›äº†è¯»å†™é”ReentrantReadWriteLockï¼Œå®ƒå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€å¯¹ç›¸å…³çš„é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œç§°ä¸ºè¯»é”ï¼›ä¸€ä¸ªç”¨äºå†™å…¥æ“ä½œï¼Œç§°ä¸ºå†™é”ï¼Œæè¿°å¦‚ä¸‹ï¼š</p><p>çº¿ç¨‹è¿›å…¥è¯»é”çš„å‰ææ¡ä»¶ï¼š</p><ul><li>æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„å†™é”</li><li>æ²¡æœ‰å†™è¯·æ±‚æˆ–è€…æœ‰å†™è¯·æ±‚ï¼Œä½†è°ƒç”¨çº¿ç¨‹å’ŒæŒæœ‰é”çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ªã€‚</li></ul><p>çº¿ç¨‹è¿›å…¥å†™é”çš„å‰ææ¡ä»¶ï¼š</p><ul><li>æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„è¯»é”</li><li>æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„å†™é”</li></ul><p>è€Œè¯»å†™é”æœ‰ä»¥ä¸‹ä¸‰ä¸ªé‡è¦çš„ç‰¹æ€§ï¼š</p><ul><li>å…¬å¹³é€‰æ‹©æ€§ï¼šæ”¯æŒéå…¬å¹³ï¼ˆé»˜è®¤ï¼‰å’Œå…¬å¹³çš„é”è·å–æ–¹å¼ï¼Œååé‡è¿˜æ˜¯éå…¬å¹³ä¼˜äºå…¬å¹³ã€‚</li><li>å¯é‡å…¥ï¼šè¯»é”å’Œå†™é”éƒ½æ”¯æŒçº¿ç¨‹é‡å…¥ã€‚ä»¥è¯»å†™çº¿ç¨‹ä¸ºä¾‹ï¼šè¯»çº¿ç¨‹è·å–è¯»é”åï¼Œèƒ½å¤Ÿå†æ¬¡è·å–è¯»é”ã€‚å†™çº¿ç¨‹åœ¨è·å–å†™é”ä¹‹åèƒ½å¤Ÿå†æ¬¡è·å–å†™é”ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è·å–è¯»é”ã€‚</li><li>é”é™çº§ï¼šéµå¾ªè·å–å†™é”ã€å†è·å–è¯»é”æœ€åé‡Šæ”¾å†™é”çš„æ¬¡åºï¼Œå†™é”èƒ½å¤Ÿé™çº§æˆä¸ºè¯»é”ã€‚</li></ul><h2 id="reentrantreadwritelockçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelockçš„ä½¿ç”¨" aria-hidden="true">#</a> ReentrantReadWriteLockçš„ä½¿ç”¨</h2><h3 id="è¯»å†™é”æ¥å£readwritelock" tabindex="-1"><a class="header-anchor" href="#è¯»å†™é”æ¥å£readwritelock" aria-hidden="true">#</a> è¯»å†™é”æ¥å£ReadWriteLock</h3><p>ä¸€å¯¹æ–¹æ³•ï¼Œåˆ†åˆ«è·å¾—è¯»é”å’Œå†™é” Lock å¯¹è±¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ReadWriteLock</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Returns the lock used for reading.
     *
     * <span class="token keyword">@return</span> the lock used for reading
     */</span>
    <span class="token class-name">Lock</span> <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Returns the lock used for writing.
     *
     * <span class="token keyword">@return</span> the lock used for writing
     */</span>
    <span class="token class-name">Lock</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="reentrantreadwritelockç±»ç»“æ„" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelockç±»ç»“æ„" aria-hidden="true">#</a> ReentrantReadWriteLockç±»ç»“æ„</h3><p>ReentrantReadWriteLockæ˜¯å¯é‡å…¥çš„è¯»å†™é”å®ç°ç±»ã€‚åœ¨å®ƒå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€å¯¹ç›¸å…³çš„é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºå†™å…¥æ“ä½œã€‚åªè¦æ²¡æœ‰ Writer çº¿ç¨‹ï¼Œè¯»é”å¯ä»¥ç”±å¤šä¸ª Reader çº¿ç¨‹åŒæ—¶æŒæœ‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†™é”æ˜¯ç‹¬å çš„ï¼Œè¯»é”æ˜¯å…±äº«çš„ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>    /** Inner class providing readlock */
    private final ReentrantReadWriteLock.ReadLock readerLock;
    /** Inner class providing writelock */
    private final ReentrantReadWriteLock.WriteLock writerLock;
    /** Performs all synchronization mechanics */
    final Sync sync;

    /**
     * Creates a new {@code ReentrantReadWriteLock} with
     * default (nonfair) ordering properties.
     */
    public ReentrantReadWriteLock() {
        this(false);
    }

    /**
     * Creates a new {@code ReentrantReadWriteLock} with
     * the given fairness policy.
     *
     * @param fair {@code true} if this lock should use a fair ordering policy
     */
    public ReentrantReadWriteLock(boolean fair) {
        sync = fair ? new FairSync() : new NonfairSync();
        readerLock = new ReadLock(this);
        writerLock = new WriteLock(this);
    }

    public ReentrantReadWriteLock.WriteLock writeLock() { return writerLock; }
    public ReentrantReadWriteLock.ReadLock  readLock()  { return readerLock; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å¦‚ä½•ä½¿ç”¨è¯»å†™é”</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ReadWriteLock</span> readWriteLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Lock</span> r <span class="token operator">=</span> readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Lock</span> w <span class="token operator">=</span> readWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¯»æ“ä½œä¸Šè¯»é”</span>
<span class="token keyword">public</span> <span class="token class-name">Data</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span> 
      <span class="token comment">// TODO ä¸šåŠ¡é€»è¾‘</span>
  <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span> 
       r<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å†™æ“ä½œä¸Šå†™é”</span>
<span class="token keyword">public</span> <span class="token class-name">Data</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Data</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span> 
      <span class="token comment">// TODO ä¸šåŠ¡é€»è¾‘</span>
  <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span> 
       w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token punctuation">}</span>           
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„äº‹é¡¹</strong></p><ul><li>è¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡</li><li>é‡å…¥æ—¶å‡çº§ä¸æ”¯æŒï¼šæŒæœ‰è¯»é”çš„æƒ…å†µä¸‹å»è·å–å†™é”ï¼Œä¼šå¯¼è‡´è·å–æ°¸ä¹…ç­‰å¾…</li><li>é‡å…¥æ—¶æ”¯æŒé™çº§ï¼š æŒæœ‰å†™é”çš„æƒ…å†µä¸‹å¯ä»¥å»è·å–è¯»é”</li></ul><h3 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯" aria-hidden="true">#</a> åº”ç”¨åœºæ™¯</h3><p>ReentrantReadWriteLocké€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯</p><p><strong>ç¤ºä¾‹Demo</strong></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cache</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">ReentrantReadWriteLock</span> rwl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Lock</span> r <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Lock</span> w <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è·å–ä¸€ä¸ªkeyå¯¹åº”çš„value</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        r<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            r<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è®¾ç½®keyå¯¹åº”çš„valueï¼Œå¹¶è¿”å›æ—§çš„value</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ¸…ç©ºæ‰€æœ‰çš„å†…å®¹</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            map<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>        
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒCacheç»„åˆä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„HashMapä½œä¸ºç¼“å­˜çš„å®ç°ï¼ŒåŒæ—¶ä½¿ç”¨è¯»å†™é”çš„è¯»é”å’Œå†™é”æ¥ä¿è¯Cacheæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚åœ¨è¯»æ“ä½œget(String key)æ–¹æ³•ä¸­ï¼Œéœ€è¦è·å–è¯»é”ï¼Œè¿™ä½¿å¾—å¹¶å‘è®¿é—®è¯¥æ–¹æ³•æ—¶ä¸ä¼šè¢«é˜»å¡ã€‚å†™æ“ä½œput(String key,Object value)æ–¹æ³•å’Œclear()æ–¹æ³•ï¼Œåœ¨æ›´æ–° HashMapæ—¶å¿…é¡»æå‰è·å–å†™é”ï¼Œå½“è·å–å†™é”åï¼Œå…¶ä»–çº¿ç¨‹å¯¹äºè¯»é”å’Œå†™é”çš„è·å–å‡è¢«é˜»å¡ï¼Œè€Œ åªæœ‰å†™é”è¢«é‡Šæ”¾ä¹‹åï¼Œå…¶ä»–è¯»å†™æ“ä½œæ‰èƒ½ç»§ç»­ã€‚Cacheä½¿ç”¨è¯»å†™é”æå‡è¯»æ“ä½œçš„å¹¶å‘æ€§ï¼Œä¹Ÿä¿è¯æ¯æ¬¡å†™æ“ä½œå¯¹æ‰€æœ‰çš„è¯»å†™æ“ä½œçš„å¯è§æ€§ï¼ŒåŒæ—¶ç®€åŒ–äº†ç¼–ç¨‹æ–¹å¼</p><h3 id="é”é™çº§" tabindex="-1"><a class="header-anchor" href="#é”é™çº§" aria-hidden="true">#</a> é”é™çº§</h3><p>é”é™çº§æŒ‡çš„æ˜¯å†™é”é™çº§æˆä¸ºè¯»é”ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ‹¥æœ‰å†™é”ï¼Œç„¶åå°†å…¶é‡Šæ”¾ï¼Œæœ€åå†è·å–è¯»é”ï¼Œè¿™ç§åˆ†æ®µå®Œæˆçš„è¿‡ç¨‹ä¸èƒ½ç§°ä¹‹ä¸ºé”é™çº§ã€‚é”é™çº§æ˜¯æŒ‡æŠŠæŒä½ï¼ˆå½“å‰æ‹¥æœ‰çš„ï¼‰å†™é”ï¼Œå†è·å–åˆ°è¯»é”ï¼Œéšåé‡Šæ”¾ï¼ˆå…ˆå‰æ‹¥æœ‰çš„ï¼‰å†™é”çš„è¿‡ç¨‹ã€‚é”é™çº§å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ‹¿åˆ°å½“å‰çº¿ç¨‹ä¿®æ”¹åçš„ç»“æœè€Œä¸è¢«å…¶ä»–çº¿ç¨‹æ‰€ç ´åï¼Œé˜²æ­¢æ›´æ–°ä¸¢å¤±ã€‚</p><p><strong>é”é™çº§çš„ä½¿ç”¨ç¤ºä¾‹</strong></p><p>å› ä¸ºæ•°æ®ä¸å¸¸å˜åŒ–ï¼Œæ‰€ä»¥å¤šä¸ªçº¿ç¨‹å¯ä»¥å¹¶å‘åœ°è¿›è¡Œæ•°æ®å¤„ç†ï¼Œå½“æ•°æ®å˜æ›´åï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ„ŸçŸ¥åˆ°æ•°æ®å˜åŒ–ï¼Œåˆ™è¿›è¡Œæ•°æ®çš„å‡†å¤‡å·¥ä½œï¼ŒåŒæ—¶å…¶ä»–å¤„ç†çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹å®Œæˆæ•°æ®çš„å‡†å¤‡å·¥ä½œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock</span> rwl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> r <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> w <span class="token operator">=</span> rwl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> update <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    readLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¿…é¡»å…ˆé‡Šæ”¾è¯»é”</span>
        readLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é”é™çº§ä»å†™é”è·å–åˆ°å¼€å§‹</span>
        writeLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// TODO å‡†å¤‡æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰  </span>
                update <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            readLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            writeLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// é”é™çº§å®Œæˆï¼Œå†™é”é™çº§ä¸ºè¯»é”</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//TODO  ä½¿ç”¨æ•°æ®çš„æµç¨‹ï¼ˆç•¥ï¼‰</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        readLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é”é™çº§ä¸­è¯»é”çš„è·å–æ˜¯å¦å¿…è¦å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¿…è¦çš„ã€‚ä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸è·å–è¯»é”è€Œæ˜¯ç›´æ¥é‡Šæ”¾å†™é”ï¼Œå‡è®¾æ­¤åˆ»å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆè®°ä½œçº¿ç¨‹Tï¼‰è·å–äº†å†™é”å¹¶ä¿®æ”¹äº†æ•°æ®ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹æ— æ³•æ„ŸçŸ¥çº¿ç¨‹Tçš„æ•°æ®æ›´æ–°ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–è¯»é”ï¼Œå³éµå¾ªé”é™çº§çš„æ­¥éª¤ï¼Œåˆ™çº¿ç¨‹Tå°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹ä½¿ç”¨æ•°æ®å¹¶é‡Šæ”¾è¯»é”ä¹‹åï¼Œçº¿ç¨‹Tæ‰èƒ½è·å–å†™é”è¿›è¡Œæ•°æ®æ›´æ–°ã€‚</p><p>RentrantReadWriteLockä¸æ”¯æŒé”å‡çº§ï¼ˆæŠŠæŒè¯»é”ã€è·å–å†™é”ï¼Œæœ€åé‡Šæ”¾è¯»é”çš„è¿‡ç¨‹ï¼‰ã€‚ç›®çš„ä¹Ÿæ˜¯ä¿è¯æ•°æ®å¯è§æ€§ï¼Œå¦‚æœè¯»é”å·²è¢«å¤šä¸ªçº¿ç¨‹è·å–ï¼Œå…¶ä¸­ä»»æ„çº¿ç¨‹æˆåŠŸè·å–äº†å†™é”å¹¶æ›´æ–°äº†æ•°æ®ï¼Œåˆ™å…¶æ›´æ–°å¯¹å…¶ä»–è·å–åˆ°è¯»é”çš„çº¿ç¨‹æ˜¯ä¸å¯è§çš„ã€‚</p><h2 id="reentrantreadwritelockæºç åˆ†æ" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelockæºç åˆ†æ" aria-hidden="true">#</a> ReentrantReadWriteLockæºç åˆ†æ</h2><p>æ€è€ƒï¼š</p><ol><li><p>è¯»å†™é”æ˜¯æ€æ ·å®ç°åˆ†åˆ«è®°å½•è¯»å†™çŠ¶æ€çš„ï¼Ÿ</p></li><li><p>å†™é”æ˜¯æ€æ ·è·å–å’Œé‡Šæ”¾çš„ï¼Ÿ</p></li><li><p>è¯»é”æ˜¯æ€æ ·è·å–å’Œé‡Šæ”¾çš„ï¼Ÿ</p></li></ol><h3 id="reentrantreadwritelockç»“æ„" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelockç»“æ„" aria-hidden="true">#</a> ReentrantReadWriteLockç»“æ„</h3><p>â€‹ <img src="https://img.jssjqd.cn/202211290255171.png" alt="image-20221129025526661" loading="lazy"></p><figure><img src="https://img.jssjqd.cn/202211290255163.png" alt="image-20221129025534999" tabindex="0" loading="lazy"><figcaption>image-20221129025534999</figcaption></figure><h3 id="è¯»å†™çŠ¶æ€çš„è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#è¯»å†™çŠ¶æ€çš„è®¾è®¡" aria-hidden="true">#</a> è¯»å†™çŠ¶æ€çš„è®¾è®¡</h3><p><strong>è®¾è®¡çš„ç²¾é«“ï¼šç”¨ä¸€ä¸ªå˜é‡å¦‚ä½•ç»´æŠ¤å¤šç§çŠ¶æ€</strong></p><p>åœ¨ ReentrantLock ä¸­ï¼Œä½¿ç”¨ Sync ( å®é™…æ˜¯ AQS )çš„ int ç±»å‹çš„ state æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œè¡¨ç¤ºé”è¢«ä¸€ä¸ªçº¿ç¨‹é‡å¤è·å–çš„æ¬¡æ•°ã€‚ä½†æ˜¯ï¼Œè¯»å†™é” ReentrantReadWriteLock å†…éƒ¨ç»´æŠ¤ç€ä¸€å¯¹è¯»å†™é”ï¼Œå¦‚æœè¦ç”¨ä¸€ä¸ªå˜é‡ç»´æŠ¤å¤šç§çŠ¶æ€ï¼Œéœ€è¦é‡‡ç”¨â€œæŒ‰ä½åˆ‡å‰²ä½¿ç”¨â€çš„æ–¹å¼æ¥ç»´æŠ¤è¿™ä¸ªå˜é‡ï¼Œå°†å…¶åˆ‡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šé«˜16ä¸ºè¡¨ç¤ºè¯»ï¼Œä½16ä¸ºè¡¨ç¤ºå†™ã€‚</p><p>åˆ†å‰²ä¹‹åï¼Œè¯»å†™é”æ˜¯å¦‚ä½•è¿…é€Ÿç¡®å®šè¯»é”å’Œå†™é”çš„çŠ¶æ€å‘¢ï¼Ÿé€šè¿‡ä½è¿ç®—ã€‚å‡å¦‚å½“å‰åŒæ­¥çŠ¶æ€ä¸ºSï¼Œé‚£ä¹ˆï¼š</p><ul><li>å†™çŠ¶æ€ï¼Œç­‰äº S &amp; 0x0000FFFFï¼ˆå°†é«˜ 16 ä½å…¨éƒ¨æŠ¹å»ï¼‰ã€‚ å½“å†™çŠ¶æ€åŠ 1ï¼Œç­‰äºS+1.</li><li>è¯»çŠ¶æ€ï¼Œç­‰äº S &gt;&gt;&gt; 16 (æ— ç¬¦å·è¡¥ 0 å³ç§» 16 ä½)ã€‚å½“è¯»çŠ¶æ€åŠ 1ï¼Œç­‰äºS+ï¼ˆ1&lt;&lt;16ï¼‰,ä¹Ÿå°±æ˜¯S+0x00010000</li></ul><p>æ ¹æ®çŠ¶æ€çš„åˆ’åˆ†èƒ½å¾—å‡ºä¸€ä¸ªæ¨è®ºï¼šSä¸ç­‰äº0æ—¶ï¼Œå½“å†™çŠ¶æ€ï¼ˆS&amp;0x0000FFFFï¼‰ç­‰äº0æ—¶ï¼Œåˆ™è¯»çŠ¶æ€ï¼ˆS&gt;&gt;&gt;16ï¼‰å¤§äº0ï¼Œå³è¯»é”å·²è¢«è·å–ã€‚</p><p>â€‹ <img src="https://img.jssjqd.cn/202211290256510.png" alt="image-20221129025609514" loading="lazy"></p><p>ä»£ç å®ç°ï¼šjava.util.concurrent.locks.ReentrantReadWriteLock.Sync</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SHARED_SHIFT</span>   <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SHARED_UNIT</span>    <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">SHARED_SHIFT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">MAX_COUNT</span>      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">SHARED_SHIFT</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">EXCLUSIVE_MASK</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token constant">SHARED_SHIFT</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/** Returns the number of shared holds represented in count. */</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">sharedCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span>    <span class="token punctuation">{</span> <span class="token keyword">return</span> c <span class="token operator">&gt;&gt;&gt;</span> <span class="token constant">SHARED_SHIFT</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token doc-comment comment">/** Returns the number of exclusive holds represented in count. */</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">exclusiveCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c <span class="token operator">&amp;</span> <span class="token constant">EXCLUSIVE_MASK</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>exclusiveCount(int c) é™æ€æ–¹æ³•ï¼Œè·å¾—æŒæœ‰å†™çŠ¶æ€çš„é”çš„æ¬¡æ•°ã€‚</li><li>sharedCount(int c) é™æ€æ–¹æ³•ï¼Œè·å¾—æŒæœ‰è¯»çŠ¶æ€çš„é”çš„çº¿ç¨‹æ•°é‡ã€‚ä¸åŒäºå†™é”ï¼Œè¯»é”å¯ä»¥åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹æŒæœ‰ã€‚è€Œæ¯ä¸ªçº¿ç¨‹æŒæœ‰çš„è¯»é”æ”¯æŒé‡å…¥çš„ç‰¹æ€§ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¯ä¸ªçº¿ç¨‹æŒæœ‰çš„è¯»é”çš„æ•°é‡å•ç‹¬è®¡æ•°ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° HoldCounter è®¡æ•°å™¨</li></ul><h3 id="holdcounter-è®¡æ•°å™¨" tabindex="-1"><a class="header-anchor" href="#holdcounter-è®¡æ•°å™¨" aria-hidden="true">#</a> HoldCounter è®¡æ•°å™¨</h3><p>è¯»é”çš„å†…åœ¨æœºåˆ¶å…¶å®å°±æ˜¯ä¸€ä¸ªå…±äº«é”ã€‚ä¸€æ¬¡å…±äº«é”çš„æ“ä½œå°±ç›¸å½“äºå¯¹HoldCounter è®¡æ•°å™¨çš„æ“ä½œã€‚è·å–å…±äº«é”ï¼Œåˆ™è¯¥è®¡æ•°å™¨ + 1ï¼Œé‡Šæ”¾å…±äº«é”ï¼Œè¯¥è®¡æ•°å™¨ - 1ã€‚åªæœ‰å½“çº¿ç¨‹è·å–å…±äº«é”åæ‰èƒ½å¯¹å…±äº«é”è¿›è¡Œé‡Šæ”¾ã€é‡å…¥æ“ä½œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * A counter for per-thread read hold counts.
 * Maintained as a ThreadLocal; cached in cachedHoldCounter.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">HoldCounter</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> count<span class="token punctuation">;</span>          <span class="token comment">// initially 0</span>
    <span class="token comment">// Use id, not reference, to avoid garbage retention</span>
    <span class="token keyword">final</span> <span class="token keyword">long</span> tid <span class="token operator">=</span> <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">getThreadId</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * ThreadLocal subclass. Easiest to explicitly define for sake
 * of deserialization mechanics.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalHoldCounter</span>
    <span class="token keyword">extends</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HoldCounter</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">HoldCounter</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HoldCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ ThreadLocalHoldCounter ç±»ï¼ŒHoldCounter ä¸çº¿ç¨‹è¿›è¡Œç»‘å®šã€‚HoldCounter æ˜¯ç»‘å®šçº¿ç¨‹çš„ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè€Œ ThreadLocalHoldCounter åˆ™æ˜¯çº¿ç¨‹ç»‘å®šçš„ ThreadLocalã€‚</p><ul><li>HoldCounteræ˜¯ç”¨æ¥è®°å½•è¯»é”é‡å…¥æ•°çš„å¯¹è±¡</li><li>ThreadLocalHoldCounteræ˜¯ThreadLocalå˜é‡ï¼Œç”¨æ¥å­˜æ”¾ä¸æ˜¯ç¬¬ä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹çš„å…¶ä»–çº¿ç¨‹çš„è¯»é”é‡å…¥æ•°å¯¹è±¡</li></ul><h3 id="å†™é”çš„è·å–" tabindex="-1"><a class="header-anchor" href="#å†™é”çš„è·å–" aria-hidden="true">#</a> å†™é”çš„è·å–</h3><p>å†™é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡è¿›å…¥çš„æ’å®ƒé”ã€‚å¦‚æœå½“å‰çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å¢åŠ å†™çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹åœ¨è·å–å†™é”æ—¶ï¼Œè¯»é”å·²ç»è¢«è·å–ï¼ˆè¯»çŠ¶æ€ä¸ä¸º0ï¼‰æˆ–è€…è¯¥çº¿ç¨‹ä¸æ˜¯å·²ç»è·å–å†™é”çš„çº¿ç¨‹ï¼Œ åˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p><p>å†™é”çš„è·å–æ˜¯é€šè¿‡é‡å†™AQSä¸­çš„tryAcquireæ–¹æ³•å®ç°çš„ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//å½“å‰çº¿ç¨‹</span>
    <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å–stateçŠ¶æ€   å­˜åœ¨è¯»é”æˆ–è€…å†™é”ï¼ŒçŠ¶æ€å°±ä¸ä¸º0</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è·å–å†™é”çš„é‡å…¥æ•°</span>
    <span class="token keyword">int</span> w <span class="token operator">=</span> <span class="token function">exclusiveCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å½“å‰åŒæ­¥çŠ¶æ€state != 0ï¼Œè¯´æ˜å·²ç»æœ‰å…¶ä»–çº¿ç¨‹è·å–äº†è¯»é”æˆ–å†™é”</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// c!=0 &amp;&amp; w==0 è¡¨ç¤ºå­˜åœ¨è¯»é”</span>
        <span class="token comment">// å½“å‰å­˜åœ¨è¯»é”æˆ–è€…å†™é”å·²ç»è¢«å…¶ä»–å†™çº¿ç¨‹è·å–ï¼Œåˆ™å†™é”è·å–å¤±è´¥</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>w <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> current <span class="token operator">!=</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">// è¶…å‡ºæœ€å¤§èŒƒå›´  65535</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>w <span class="token operator">+</span> <span class="token function">exclusiveCount</span><span class="token punctuation">(</span>acquires<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token constant">MAX_COUNT</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Maximum lock count exceeded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åŒæ­¥stateçŠ¶æ€</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>c <span class="token operator">+</span> acquires<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// writerShouldBlockæœ‰å…¬å¹³ä¸éå…¬å¹³çš„å®ç°, éå…¬å¹³è¿”å›falseï¼Œä¼šå°è¯•é€šè¿‡casåŠ é”</span>
    <span class="token comment">//c==0 å†™é”æœªè¢«ä»»ä½•çº¿ç¨‹è·å–ï¼Œå½“å‰çº¿ç¨‹æ˜¯å¦é˜»å¡æˆ–è€…caså°è¯•è·å–é” </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">writerShouldBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token operator">!</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> c <span class="token operator">+</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">//è®¾ç½®å†™é”ä¸ºå½“å‰çº¿ç¨‹æ‰€æœ‰</span>
    <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>       
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡æºç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p><ul><li>è¯»å†™äº’æ–¥</li><li>å†™å†™äº’æ–¥</li><li>å†™é”æ”¯æŒåŒä¸€ä¸ªçº¿ç¨‹é‡å…¥</li><li>writerShouldBlockå†™é”æ˜¯å¦é˜»å¡å®ç°å–å†³å…¬å¹³ä¸éå…¬å¹³çš„ç­–ç•¥ï¼ˆFairSyncå’ŒNonfairSyncï¼‰</li></ul><p>â€‹ <img src="https://img.jssjqd.cn/202211290303746.png" alt="image-20221129030349508" loading="lazy"></p><p>æ€è€ƒï¼šæœ‰çº¿ç¨‹è¯»çš„è¿‡ç¨‹ä¸­ä¸å…è®¸å†™ï¼Œè¿™ç§è®¾è®¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><h3 id="å†™é”çš„é‡Šæ”¾" tabindex="-1"><a class="header-anchor" href="#å†™é”çš„é‡Šæ”¾" aria-hidden="true">#</a> å†™é”çš„é‡Šæ”¾</h3><p>å†™é”é‡Šæ”¾é€šè¿‡é‡å†™AQSçš„tryReleaseæ–¹æ³•å®ç°</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryRelease</span><span class="token punctuation">(</span><span class="token keyword">int</span> releases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è‹¥é”çš„æŒæœ‰è€…ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isHeldExclusively</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalMonitorStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> nextc <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> releases<span class="token punctuation">;</span>
    <span class="token comment">//å½“å‰å†™çŠ¶æ€æ˜¯å¦ä¸º0ï¼Œä¸º0åˆ™é‡Šæ”¾å†™é”</span>
    <span class="token keyword">boolean</span> free <span class="token operator">=</span> <span class="token function">exclusiveCount</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>free<span class="token punctuation">)</span>
        <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> free<span class="token punctuation">;</span>    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ <img src="https://img.jssjqd.cn/202211290304112.png" alt="image-20221129030408101" loading="lazy"></p><h3 id="è¯»é”çš„è·å–" tabindex="-1"><a class="header-anchor" href="#è¯»é”çš„è·å–" aria-hidden="true">#</a> è¯»é”çš„è·å–</h3><p>å®ç°å…±äº«å¼åŒæ­¥ç»„ä»¶çš„åŒæ­¥è¯­ä¹‰éœ€è¦é€šè¿‡é‡å†™AQSçš„tryAcquireSharedæ–¹æ³•å’ŒtryReleaseSharedæ–¹æ³•ã€‚è¯»é”çš„è·å–å®ç°æ–¹æ³•ä¸ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">tryAcquireShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> unused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœå†™é”å·²ç»è¢«è·å–å¹¶ä¸”è·å–å†™é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥è¿”å›-1   åˆ¤æ–­é”é™çº§</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">exclusiveCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> current<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">//è®¡ç®—å‡ºè¯»é”çš„æ•°é‡</span>
    <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token function">sharedCount</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
    * è¯»é”æ˜¯å¦é˜»å¡    readerShouldBlock()å…¬å¹³ä¸éå…¬å¹³çš„å®ç°
    * r &lt; MAX_COUNTï¼š æŒæœ‰è¯»é”çš„çº¿ç¨‹å°äºæœ€å¤§æ•°ï¼ˆ65535ï¼‰
    *  compareAndSetState(c, c + SHARED_UNIT) casè®¾ç½®è·å–è¯»é”çº¿ç¨‹çš„æ•°é‡
    */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">readerShouldBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        r <span class="token operator">&lt;</span> <span class="token constant">MAX_COUNT</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">compareAndSetState</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> c <span class="token operator">+</span> <span class="token constant">SHARED_UNIT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//å½“å‰çº¿ç¨‹è·å–è¯»é”</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//è®¾ç½®ç¬¬ä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹</span>
            firstReader <span class="token operator">=</span> current<span class="token punctuation">;</span> 
            firstReaderHoldCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//è®¾ç½®ç¬¬ä¸€ä¸ªè·å–è¯»é”çº¿ç¨‹çš„é‡å…¥æ•°</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>firstReader <span class="token operator">==</span> current<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¡¨ç¤ºç¬¬ä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹é‡å…¥</span>
            firstReaderHoldCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// éç¬¬ä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹</span>
            <span class="token class-name">HoldCounter</span> rh <span class="token operator">=</span> cachedHoldCounter<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rh <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> rh<span class="token punctuation">.</span>tid <span class="token operator">!=</span> <span class="token function">getThreadId</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span>
                cachedHoldCounter <span class="token operator">=</span> rh <span class="token operator">=</span> readHolds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rh<span class="token punctuation">.</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                readHolds<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>rh<span class="token punctuation">)</span><span class="token punctuation">;</span>
            rh<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">//è®°å½•å…¶ä»–è·å–è¯»é”çš„çº¿ç¨‹çš„é‡å…¥æ¬¡æ•°</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å°è¯•é€šè¿‡è‡ªæ—‹çš„æ–¹å¼è·å–è¯»é”,å®ç°äº†é‡å…¥é€»è¾‘</span>
    <span class="token keyword">return</span> <span class="token function">fullTryAcquireShared</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>        
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è¯»é”å…±äº«ï¼Œè¯»è¯»ä¸äº’æ–¥</li><li>è¯»é”å¯é‡å…¥ï¼Œæ¯ä¸ªè·å–è¯»é”çš„çº¿ç¨‹éƒ½ä¼šè®°å½•å¯¹åº”çš„é‡å…¥æ•°</li><li>è¯»å†™äº’æ–¥ï¼Œé”é™çº§åœºæ™¯é™¤å¤–</li><li>æ”¯æŒé”é™çº§ï¼ŒæŒæœ‰å†™é”çš„çº¿ç¨‹ï¼Œå¯ä»¥è·å–è¯»é”ï¼Œä½†æ˜¯åç»­è¦è®°å¾—æŠŠè¯»é”å’Œå†™é”è¯»é‡Šæ”¾</li><li>readerShouldBlockè¯»é”æ˜¯å¦é˜»å¡å®ç°å–å†³å…¬å¹³ä¸éå…¬å¹³çš„ç­–ç•¥ï¼ˆFairSyncå’ŒNonfairSyncï¼‰</li></ul><figure><img src="https://img.jssjqd.cn/202211290307909.png" alt="image-20221129030707587" tabindex="0" loading="lazy"><figcaption>image-20221129030707587</figcaption></figure><h3 id="è¯»é”çš„é‡Šæ”¾" tabindex="-1"><a class="header-anchor" href="#è¯»é”çš„é‡Šæ”¾" aria-hidden="true">#</a> è¯»é”çš„é‡Šæ”¾</h3><p>è·å–åˆ°è¯»é”ï¼Œæ‰§è¡Œå®Œä¸´ç•ŒåŒºåï¼Œè¦è®°å¾—é‡Šæ”¾è¯»é”ï¼ˆå¦‚æœé‡å…¥å¤šæ¬¡è¦é‡Šæ”¾å¯¹åº”çš„æ¬¡æ•°ï¼‰ï¼Œä¸ç„¶ä¼šé˜»å¡å…¶ä»–çº¿ç¨‹çš„å†™æ“ä½œã€‚</p><p>è¯»é”é‡Šæ”¾çš„å®ç°ä¸»è¦é€šè¿‡æ–¹æ³•tryReleaseSharedï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryReleaseShared</span><span class="token punctuation">(</span><span class="token keyword">int</span> unused<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¦‚æœå½“å‰çº¿ç¨‹æ˜¯ç¬¬ä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstReader <span class="token operator">==</span> current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// assert firstReaderHoldCount &gt; 0;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstReaderHoldCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
            firstReader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            firstReaderHoldCount<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">//é‡å…¥æ¬¡æ•°å‡1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">//ä¸æ˜¯ç¬¬ä¸€ä¸ªè·å–è¯»é”çš„çº¿ç¨‹</span>
        <span class="token class-name">HoldCounter</span> rh <span class="token operator">=</span> cachedHoldCounter<span class="token punctuation">;</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rh <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> rh<span class="token punctuation">.</span>tid <span class="token operator">!=</span> <span class="token function">getThreadId</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">)</span>
            rh <span class="token operator">=</span> readHolds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> rh<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readHolds<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token function">unmatchedUnlockException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token operator">--</span>rh<span class="token punctuation">.</span>count<span class="token punctuation">;</span>  <span class="token comment">//é‡å…¥æ¬¡æ•°å‡1</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//casæ›´æ–°åŒæ­¥çŠ¶æ€</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">-</span> <span class="token constant">SHARED_UNIT</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> nextc<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">// Releasing the read lock has no effect on readers,</span>
            <span class="token comment">// but it may allow waiting writers to proceed if</span>
            <span class="token comment">// both read and write locks are now free.</span>
            <span class="token keyword">return</span> nextc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹ <img src="https://img.jssjqd.cn/202211290304688.png" alt="image-20221129030425009" loading="lazy"></p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: thejqd@gmail.com">jiangqingdong</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><!----><div class="copyright">Copyright Â© 2023 æ±Ÿ</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-21ce620e.js" defer></script>
  </body>
</html>
